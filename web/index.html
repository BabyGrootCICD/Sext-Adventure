<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tsext Adventure: Halloween Haunt</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.3);
            border: 2px solid #ff6b35;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            color: #ff6b35;
            text-shadow: 0 0 10px #ff6b35;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #8b5cf6;
            margin-bottom: 20px;
        }

        .warning {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid #ff6b35;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-area {
            min-height: 400px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .scene-title {
            font-size: 1.5em;
            color: #ff6b35;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #ff6b35;
            padding-bottom: 10px;
        }

        .scene-description {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #e0e0e0;
        }

        .choices {
            margin-top: 20px;
        }

        .choice {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid #8b5cf6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            color: #fff;
            text-decoration: none;
            display: block;
            user-select: none;
            -webkit-user-select: none;
            /* æ”¹å–„è§¸æ§å›é¥‹ */
            -webkit-tap-highlight-color: rgba(139, 92, 246, 0.3);
            touch-action: manipulation;
        }

        .choice:hover {
            background: rgba(139, 92, 246, 0.4);
            transform: translateX(5px);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
        }

        .ending {
            text-align: center;
            padding: 20px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 10px;
            border: 2px solid #ff6b35;
        }

        .ending-title {
            font-size: 1.8em;
            color: #ff6b35;
            margin-bottom: 15px;
        }

        .ending-outcome {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .score {
            font-size: 1.1em;
            color: #8b5cf6;
            margin-bottom: 15px;
        }

        .restart-btn {
            background: linear-gradient(45deg, #ff6b35, #8b5cf6);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        .start-screen {
            text-align: center;
        }

        .player-input {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b5cf6;
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 1.1em;
            width: 100%;
            max-width: 300px;
            margin: 20px auto;
            text-align: center;
        }

        .start-btn {
            background: linear-gradient(45deg, #8b5cf6, #ff6b35);
            border: none;
            border-radius: 25px;
            padding: 15px 40px;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.5);
        }

        .start-btn:focus,
        .restart-btn:focus,
        .share-btn:focus,
        .close-btn:focus {
            outline: 2px solid #8b5cf6;
            outline-offset: 2px;
        }

        /* éµç›¤å°èˆªæ”¯æ´ */
        .choice:focus {
            outline: 2px solid #8b5cf6;
            outline-offset: 2px;
            background: rgba(139, 92, 246, 0.4);
        }

        .achievements-toggle:focus {
            outline: 2px solid #8b5cf6;
            outline-offset: 2px;
        }

        /* è¼‰å…¥ç‹€æ…‹æ”¹å–„ */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #8b5cf6;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æ•ˆèƒ½å„ªåŒ– */
        * {
            box-sizing: border-box;
        }

        .container,
        .game-area,
        .achievement-popup {
            will-change: transform;
            backface-visibility: hidden;
        }

        /* é˜²æ­¢æ–‡å­—é¸å– */
        .achievement-popup,
        .stats-panel,
        .achievements-panel {
            user-select: none;
            -webkit-user-select: none;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.9em;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 3px solid #ff6b35;
            border-radius: 15px;
            padding: 30px;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 107, 53, 0.5);
            animation: achievementPop 0.5s ease-out;
        }

        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .achievement-icon {
            font-size: 4em;
            margin-bottom: 15px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .achievement-title {
            font-size: 1.8em;
            color: #ff6b35;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .achievement-description {
            font-size: 1.1em;
            color: #e0e0e0;
            margin-bottom: 20px;
        }

        .achievement-rarity {
            font-size: 1em;
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .rarity-common { background: #9CA3AF; color: #000; }
        .rarity-rare { background: #3B82F6; color: #fff; }
        .rarity-epic { background: #8B5CF6; color: #fff; }
        .rarity-legendary { background: #F59E0B; color: #000; }

        .achievement-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .share-btn {
            background: linear-gradient(45deg, #ff6b35, #8b5cf6);
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .share-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.5);
        }

        .close-btn {
            background: #666;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .close-btn:hover {
            background: #888;
            transform: scale(1.05);
        }

        .achievements-panel {
            position: fixed;
            top: 20px;
            right: -320px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #8b5cf6;
            border-radius: 10px 0 0 10px;
            padding: 15px;
            z-index: 100;
            max-width: 300px;
            width: 300px;
            max-height: 80vh;
            overflow-y: auto;
            transition: right 0.3s ease;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
        }

        .achievements-panel.open {
            right: 0;
        }

        .achievements-toggle {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #8b5cf6, #ff6b35);
            border: 2px solid #8b5cf6;
            border-right: none;
            border-radius: 10px 0 0 10px;
            padding: 15px 10px;
            cursor: pointer;
            z-index: 101;
            transition: all 0.3s ease;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-weight: bold;
            color: white;
            font-size: 1em;
        }

        .achievements-toggle:hover {
            padding-left: 15px;
            box-shadow: -5px 0 15px rgba(139, 92, 246, 0.5);
        }

        .achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b5cf6;
        }

        .achievements-title {
            font-size: 1.2em;
            color: #8b5cf6;
            font-weight: bold;
        }

        .achievements-close {
            background: transparent;
            border: none;
            color: #ff6b35;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .achievements-close:hover {
            background: rgba(255, 107, 53, 0.2);
            transform: rotate(90deg);
        }

        .achievement-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .achievement-item:hover {
            background: rgba(139, 92, 246, 0.2);
            transform: translateX(5px);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .achievement-item.unlocked {
            background: rgba(255, 107, 53, 0.2);
            border-color: rgba(255, 107, 53, 0.5);
        }

        .achievement-item.unlocked:hover {
            background: rgba(255, 107, 53, 0.3);
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        .achievement-item-icon {
            font-size: 2em;
            margin-right: 12px;
            min-width: 40px;
            text-align: center;
        }

        .achievement-item-text {
            flex: 1;
        }

        .achievement-item-name {
            font-size: 0.95em;
            color: #fff;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .achievement-item-desc {
            font-size: 0.8em;
            color: #ccc;
            line-height: 1.3;
        }

        .stats-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #ff6b35;
            border-radius: 10px;
            padding: 15px;
            z-index: 100;
            min-width: 200px;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.5);
        }

        .stats-title {
            font-size: 1.2em;
            color: #ff6b35;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #e0e0e0;
            padding: 5px;
            border-radius: 5px;
            background: rgba(255, 107, 53, 0.1);
        }

        .stat-item span:first-child {
            font-weight: 600;
        }

        .stat-item span:last-child {
            color: #ff6b35;
            font-weight: bold;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        .loading {
            text-align: center;
            color: #8b5cf6;
            font-size: 1.2em;
        }

        /* RWD - å¤§å‹è¢å¹• */
        @media (min-width: 1200px) {
            .container {
                max-width: 1000px;
            }

            .title {
                font-size: 3em;
            }

            .achievements-panel {
                width: 350px;
                right: -370px;
            }

            .stats-panel {
                min-width: 220px;
            }
        }

        /* RWD - å¹³æ¿å’Œå°è¢å¹• */
        @media (max-width: 1024px) {
            .stats-panel {
                top: 10px;
                left: 10px;
                min-width: 150px;
                font-size: 0.9em;
            }

            .achievements-panel {
                width: 250px;
                right: -270px;
            }

            .achievements-toggle {
                font-size: 0.9em;
                padding: 12px 8px;
            }

            /* æ”¹å–„æŒ‰éˆ•è§¸æ§å€åŸŸ */
            .choice {
                padding: 18px;
                margin-bottom: 12px;
                font-size: 1em;
            }

            .start-btn, .restart-btn {
                padding: 15px 35px;
                font-size: 1.1em;
                min-height: 50px;
            }
        }

        /* RWD - æ‰‹æ©Ÿæ©«å‘ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 5px;
                width: calc(100% - 10px);
            }
            
            .title {
                font-size: 1.8em;
                line-height: 1.2;
                margin-bottom: 15px;
            }

            .subtitle {
                font-size: 1em;
                line-height: 1.4;
                margin-bottom: 15px;
            }

            .warning {
                font-size: 0.9em;
                padding: 12px;
                margin-bottom: 15px;
            }
            
            .scene-title {
                font-size: 1.2em;
                line-height: 1.3;
                padding-bottom: 8px;
            }

            .scene-description {
                font-size: 1em;
                line-height: 1.5;
                margin-bottom: 15px;
            }

            .choice {
                font-size: 0.95em;
                padding: 15px;
                margin-bottom: 10px;
                border-radius: 10px;
                /* æ”¹å–„è§¸æ§é«”é©— */
                min-height: 50px;
                display: flex;
                align-items: center;
                cursor: pointer;
                -webkit-tap-highlight-color: rgba(139, 92, 246, 0.3);
            }

            .choice:active {
                transform: translateX(3px) scale(0.98);
                background: rgba(139, 92, 246, 0.6);
            }

            .stats-panel {
                top: 10px;
                left: 10px;
                min-width: 120px;
                font-size: 0.85em;
                padding: 10px;
                border-radius: 8px;
            }

            .stats-title {
                font-size: 1em;
                margin-bottom: 8px;
            }

            .stat-item {
                font-size: 0.85em;
                margin-bottom: 5px;
                padding: 3px 5px;
            }

            .achievements-panel {
                width: 220px;
                right: -240px;
                max-height: 70vh;
                border-radius: 10px 0 0 10px;
            }

            .achievements-toggle {
                font-size: 0.85em;
                padding: 10px 6px;
                border-radius: 8px 0 0 8px;
            }

            .achievement-popup {
                width: 90%;
                max-width: 350px;
                padding: 20px;
                max-height: 80vh;
                overflow-y: auto;
            }

            .achievement-icon {
                font-size: 3em;
                margin-bottom: 10px;
            }

            .achievement-title {
                font-size: 1.5em;
                line-height: 1.2;
                margin-bottom: 8px;
            }

            .achievement-description {
                font-size: 0.95em;
                line-height: 1.4;
            }

            .share-btn, .close-btn {
                font-size: 0.9em;
                padding: 10px 18px;
                border-radius: 20px;
                margin: 5px;
                min-height: 40px;
                /* æ”¹å–„è§¸æ§é«”é©— */
                -webkit-tap-highlight-color: transparent;
            }

            .share-btn:active, .close-btn:active {
                transform: scale(0.95);
            }

            .player-input {
                font-size: 1em;
                padding: 12px;
                border-radius: 8px;
                width: 90%;
            }

            .start-btn, .restart-btn {
                font-size: 1em;
                padding: 12px 25px;
                border-radius: 20px;
                min-height: 45px;
                margin: 10px 5px;
            }
        }

        /* RWD - æ‰‹æ©Ÿç›´å‘ */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 12px;
                margin: 0;
                width: 100%;
                max-width: none;
                border-radius: 10px;
                box-shadow: 0 0 20px rgba(255, 107, 53, 0.2);
            }

            .header {
                margin-bottom: 20px;
            }

            .title {
                font-size: 1.4em;
                line-height: 1.1;
                margin-bottom: 8px;
                text-shadow: 0 0 8px #ff6b35;
            }

            .subtitle {
                font-size: 0.9em;
                line-height: 1.3;
                margin-bottom: 12px;
            }

            .warning {
                font-size: 0.85em;
                padding: 10px;
                border-radius: 8px;
                margin-bottom: 15px;
                line-height: 1.3;
            }

            .game-area {
                padding: 15px;
                min-height: 300px;
                border-radius: 8px;
                margin-bottom: 15px;
            }

            .scene-title {
                font-size: 1.1em;
                line-height: 1.2;
                margin-bottom: 10px;
                padding-bottom: 8px;
            }

            .scene-description {
                font-size: 0.9em;
                line-height: 1.4;
                margin-bottom: 15px;
            }

            .choices {
                margin-top: 15px;
            }

            .choice {
                font-size: 0.85em;
                padding: 12px;
                margin-bottom: 8px;
                border-radius: 8px;
                line-height: 1.3;
                min-height: 45px;
                display: flex;
                align-items: center;
                text-align: left;
                /* å„ªåŒ–å°è¢å¹•è§¸æ§ */
                -webkit-tap-highlight-color: rgba(139, 92, 246, 0.2);
                touch-action: manipulation;
            }

            .choice:hover {
                transform: translateX(2px);
            }

            .choice:active {
                transform: translateX(1px) scale(0.98);
            }

            .stats-panel {
                position: relative;
                top: 0;
                left: 0;
                width: 100%;
                margin-bottom: 10px;
                box-sizing: border-box;
                border-radius: 8px;
                padding: 10px;
            }

            .stats-title {
                font-size: 0.9em;
                margin-bottom: 6px;
            }

            .stat-item {
                font-size: 0.8em;
                margin-bottom: 4px;
                padding: 2px 4px;
            }

            .achievements-panel {
                width: 90%;
                right: -95%;
                top: 60px;
                max-height: 65vh;
                border-radius: 8px 0 0 8px;
            }

            .achievements-toggle {
                top: 60%;
                font-size: 0.75em;
                padding: 8px 4px;
                border-radius: 6px 0 0 6px;
                writing-mode: vertical-rl;
            }

            .achievement-popup {
                width: 96%;
                padding: 15px;
                max-height: 85vh;
                border-radius: 12px;
                margin: 0 2%;
            }

            .achievement-icon {
                font-size: 2.5em;
                margin-bottom: 8px;
            }

            .achievement-title {
                font-size: 1.2em;
                line-height: 1.1;
                margin-bottom: 6px;
            }

            .achievement-description {
                font-size: 0.85em;
                line-height: 1.3;
                margin-bottom: 10px;
            }

            .achievement-rarity {
                font-size: 0.8em;
                padding: 4px 12px;
                margin-bottom: 15px;
            }

            .achievement-actions {
                flex-direction: column;
                gap: 8px;
            }

            .achievement-actions button {
                width: 100%;
                min-height: 42px;
                font-size: 0.85em;
                padding: 10px 15px;
                border-radius: 20px;
            }

            .player-input {
                width: 95%;
                max-width: 280px;
                font-size: 0.95em;
                padding: 10px;
                border-radius: 8px;
                margin: 15px auto;
            }

            .start-btn, .restart-btn {
                font-size: 0.95em;
                padding: 12px 25px;
                border-radius: 20px;
                min-height: 45px;
                margin: 8px 4px;
            }

            .ending {
                padding: 15px;
                border-radius: 8px;
                margin-top: 15px;
            }

            .ending-title {
                font-size: 1.4em;
                line-height: 1.2;
                margin-bottom: 10px;
            }

            .ending-outcome {
                font-size: 0.95em;
                line-height: 1.4;
                margin-bottom: 15px;
            }

            .score {
                font-size: 0.9em;
                margin-bottom: 10px;
            }

            .footer {
                margin-top: 20px;
                font-size: 0.8em;
                line-height: 1.3;
            }

            .footer a {
                color: #8b5cf6;
                text-decoration: none;
            }

            .footer a:hover {
                text-decoration: underline;
            }
        }

        /* RWD - è¶…å°è¢å¹• (320px - 360px) */
        @media (max-width: 360px) {
            body {
                padding: 5px;
            }

            .container {
                padding: 8px;
                border-radius: 8px;
            }

            .title {
                font-size: 1.2em;
                line-height: 1.1;
                margin-bottom: 6px;
            }

            .subtitle {
                font-size: 0.85em;
                margin-bottom: 10px;
            }

            .warning {
                font-size: 0.8em;
                padding: 8px;
                margin-bottom: 12px;
            }

            .game-area {
                padding: 12px;
                min-height: 250px;
            }

            .scene-title {
                font-size: 1em;
                line-height: 1.1;
                margin-bottom: 8px;
                padding-bottom: 6px;
            }

            .scene-description {
                font-size: 0.85em;
                line-height: 1.4;
                margin-bottom: 12px;
            }

            .choice {
                font-size: 0.8em;
                padding: 10px;
                margin-bottom: 6px;
                min-height: 40px;
                border-radius: 6px;
            }

            .stats-panel {
                font-size: 0.75em;
                padding: 8px;
            }

            .stats-title {
                font-size: 0.85em;
                margin-bottom: 5px;
            }

            .stat-item {
                font-size: 0.75em;
                margin-bottom: 3px;
                padding: 1px 3px;
            }

            .achievement-popup {
                width: 98%;
                padding: 12px;
                margin: 0 1%;
            }

            .achievement-icon {
                font-size: 2.2em;
            }

            .achievement-title {
                font-size: 1.1em;
            }

            .achievement-description {
                font-size: 0.8em;
            }

            .achievement-actions button {
                font-size: 0.8em;
                padding: 8px 12px;
                min-height: 38px;
            }

            .player-input {
                font-size: 0.9em;
                padding: 8px;
                width: 98%;
                max-width: 250px;
            }

            .start-btn, .restart-btn {
                font-size: 0.9em;
                padding: 10px 20px;
                min-height: 42px;
            }

            .ending-title {
                font-size: 1.2em;
            }

            .ending-outcome {
                font-size: 0.9em;
            }

            .footer {
                font-size: 0.75em;
                margin-top: 15px;
            }
        }

        /* è¼”åŠ©åŠŸèƒ½æ”¹å–„ */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .choice:hover,
            .choice:active {
                transform: none;
            }
        }

        /* é«˜å°æ¯”åº¦æ¨¡å¼æ”¯æ´ */
        @media (prefers-contrast: high) {
            .container {
                border: 3px solid #fff;
                background: rgba(0, 0, 0, 0.95);
            }
            
            .choice {
                border: 2px solid #fff;
                background: rgba(139, 92, 246, 0.8);
            }
            
            .achievement-popup {
                border: 3px solid #fff;
                background: rgba(0, 0, 0, 0.95);
            }
        }

        /* æš—è‰²ä¸»é¡Œåå¥½ */
        @media (prefers-color-scheme: dark) {
            /* æœ¬éŠæˆ²é è¨­å°±æ˜¯æš—è‰²ä¸»é¡Œï¼Œæ‰€ä»¥ä¸éœ€è¦é¡å¤–èª¿æ•´ */
        }

        /* æ²è»¸æ¨£å¼ */
        .achievements-panel::-webkit-scrollbar {
            width: 8px;
        }

        .achievements-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .achievements-panel::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 4px;
        }

        .achievements-panel::-webkit-scrollbar-thumb:hover {
            background: #a78bfa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸƒ Tsext Adventure: Halloween Haunt ğŸƒ</h1>
            <p class="subtitle">è¬è–ç¯€ç‘Ÿç‘Ÿå†’éšªéŠæˆ²</p>
        </div>

        <div class="warning">
            âš ï¸ <strong>NSFW è­¦å‘Š</strong>ï¼šæœ¬éŠæˆ²åŒ…å«æˆäººæš—ç¤ºå’Œå¹½é»˜ï¼Œé©åˆ 18 æ­²ä»¥ä¸Šç©å®¶
        </div>

        <!-- çµ±è¨ˆé¢æ¿ -->
        <div class="stats-panel" id="statsPanel" style="display: none;">
            <div class="stats-title">ğŸ“Š éŠæˆ²çµ±è¨ˆ</div>
            <div class="stat-item">
                <span>ç¸½åˆ†æ•¸:</span>
                <span id="totalScore">0</span>
            </div>
            <div class="stat-item">
                <span>éŠç©æ¬¡æ•¸:</span>
                <span id="playCount">0</span>
            </div>
            <div class="stat-item">
                <span>è§£é–æˆå°±:</span>
                <span id="achievementCount">0</span>
            </div>
            <div class="stat-item">
                <span>æ¢ç´¢å ´æ™¯:</span>
                <span id="sceneCount">0</span>
            </div>
        </div>

        <!-- æˆå°±åˆ‡æ›æŒ‰éˆ• -->
        <div class="achievements-toggle" id="achievementsToggle" onclick="toggleAchievementsPanel()" style="display: none;">
            ğŸ† æˆå°±åˆ—è¡¨
        </div>

        <!-- æˆå°±é¢æ¿ -->
        <div class="achievements-panel" id="achievementsPanel">
            <div class="achievements-header">
                <div class="achievements-title">ğŸ† æˆå°±åˆ—è¡¨</div>
                <button class="achievements-close" onclick="toggleAchievementsPanel()">âœ•</button>
            </div>
            <div id="achievementsList"></div>
        </div>

        <div class="game-area" id="gameArea">
            <div class="start-screen" id="startScreen">
                <h2>ğŸ‘» æ­¡è¿ä¾†åˆ°è¬è–ç¯€éˆç•°ç´„æœƒè¶´ï¼</h2>
                <p>æº–å‚™å¥½åƒåŠ æœ€åˆºæ¿€çš„è¬è–ç¯€å†’éšªäº†å—ï¼Ÿ</p>
                <input type="text" class="player-input" id="playerName" placeholder="è«‹è¼¸å…¥ä½ çš„åå­—" maxlength="20">
                <br>
                <button class="start-btn" onclick="startGame()">é–‹å§‹å†’éšª ğŸƒ</button>
            </div>
        </div>

        <div class="footer">
            <p>ğŸƒ Happy Halloween! ğŸƒ</p>
            <p>é–‹æºå°ˆæ¡ˆ | MIT License | <a href="https://github.com/dennislee928/tsext-adventure" style="color: #8b5cf6;">GitHub</a></p>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            currentScene: 'start',
            playerName: '',
            score: 0,
            visitedScenes: new Set(),
            unlockedAchievements: new Set(),
            unlockedBadges: new Set(),
            playCount: 0,
            totalScore: 0,
            gameStartTime: null,
            allEndingsUnlocked: new Set(),
            allScenesVisited: new Set(),
            punsTriggered: new Set()
        };

        // æˆå°±è³‡æ–™
        const achievementsData = {
            "magic_knight": {
                "name": "é­”æ³•é¨å£«",
                "description": "èˆ‡å¥³å·«é”æˆå®Œç¾çµå±€",
                "icon": "ğŸ§™â€â™€ï¸",
                "rarity": "legendary",
                "condition": "ending_rooftop_romance",
                "points": 100
            },
            "moonlight_lover": {
                "name": "æœˆå…‰æˆ€äºº",
                "description": "åœ¨æœˆå…‰æ¹–åº¦éæµªæ¼«å¤œæ™š",
                "icon": "ğŸŒ™",
                "rarity": "epic",
                "condition": "ending_moonlight_adventure",
                "points": 90
            },
            "ghost_lover": {
                "name": "é¬¼é­‚æˆ€äºº",
                "description": "èˆ‡é¬¼é­‚é«”é©—å¥‡ç•°è¦ªå¯†",
                "icon": "ğŸ‘»",
                "rarity": "rare",
                "condition": "ending_ghost_intimacy",
                "points": 85
            },
            "pumpkin_master": {
                "name": "å—ç“œå¤§å¸«",
                "description": "åœ¨å—ç“œç”°ç™¼æ®å‰µæ„",
                "icon": "ğŸƒ",
                "rarity": "rare",
                "condition": "ending_big_pumpkin_fun",
                "points": 75
            },
            "field_lover": {
                "name": "ç”°é‡æˆ€äºº",
                "description": "èˆ‡è¾²å¤«å¥³éƒåº¦éæ¿€æƒ…å¤œæ™š",
                "icon": "ğŸŒ¾",
                "rarity": "epic",
                "condition": "ending_farmer_seduction",
                "points": 95
            },
            "cat_friend": {
                "name": "è²“å’ªä¹‹å‹",
                "description": "èˆ‡é»‘è²“å’ªå’ªå»ºç«‹å‹èª¼",
                "icon": "ğŸ±",
                "rarity": "common",
                "condition": "ending_cat_adventure",
                "points": 60
            },
            "cat_lady_lover": {
                "name": "è²“å¥³æˆ€äºº",
                "description": "èˆ‡è²“å¥³è‰è‰åº¦éæµªæ¼«æ™‚å…‰",
                "icon": "ğŸ±â€ğŸ‘¤",
                "rarity": "rare",
                "condition": "ending_cat_lady_romance",
                "points": 80
            },
            "soul_mate": {
                "name": "å¿ƒéˆä¼´ä¾¶",
                "description": "èˆ‡è¾²å¤«å¥³éƒå»ºç«‹æƒ…æ„Ÿé€£æ¥",
                "icon": "ğŸ’•",
                "rarity": "rare",
                "condition": "ending_heart_to_heart",
                "points": 85
            },
            "passion_lover": {
                "name": "æ¿€æƒ…æˆ€äºº",
                "description": "é«”é©—ç«ç†±çš„æ¿€æƒ…å¤œæ™š",
                "icon": "ğŸ”¥",
                "rarity": "epic",
                "condition": "ending_physical_attraction",
                "points": 90
            },
            "cold_warrior": {
                "name": "å†°å†·æˆ°å£«",
                "description": "å‹‡æ•¢é¢å°é¬¼é­‚çš„å†°å†·è§¸æ‘¸",
                "icon": "â„ï¸",
                "rarity": "common",
                "condition": "ending_cold_encounter",
                "points": 70
            },
            "floating_fool": {
                "name": "æ¼‚æµ®å‚»ç“œ",
                "description": "å› ç‚ºç„¡ç¦®è€Œæ¼‚æµ®æ’å£åŠç‡ˆ",
                "icon": "ğŸ’¥",
                "rarity": "common",
                "condition": "ending_floating_mischief",
                "points": 30
            },
            "pumpkin_crusher": {
                "name": "å—ç“œç²‰ç¢è€…",
                "description": "æ‘”ç¢å—ç“œä½†å­¸åˆ°æ•™è¨“",
                "icon": "ğŸƒğŸ’¥",
                "rarity": "common",
                "condition": "ending_pumpkin_lifting",
                "points": 20
            },
            "ghost_chaser": {
                "name": "é¬¼é­‚è¿½é€è€…",
                "description": "è¢«é¬¼é­‚è¿½é€æœ€å¾Œçµ†å€’",
                "icon": "ğŸƒâ€â™‚ï¸ğŸ‘»",
                "rarity": "common",
                "condition": "ending_ghost_chase",
                "points": 25
            },
            "explorer": {
                "name": "æ¢ç´¢è€…",
                "description": "æ¢ç´¢äº†æ‰€æœ‰ä¸»è¦å ´æ™¯",
                "icon": "ğŸ—ºï¸",
                "rarity": "rare",
                "condition": "visited_all_scenes",
                "points": 50
            },
            "completionist": {
                "name": "å®Œç¾ä¸»ç¾©è€…",
                "description": "è§£é–äº†æ‰€æœ‰çµå±€",
                "icon": "ğŸ†",
                "rarity": "legendary",
                "condition": "all_endings_unlocked",
                "points": 200
            },
            "speed_demon": {
                "name": "é€Ÿåº¦æƒ¡é­”",
                "description": "åœ¨ 5 åˆ†é˜å…§å®ŒæˆéŠæˆ²",
                "icon": "âš¡",
                "rarity": "rare",
                "condition": "speed_run_5min",
                "points": 75
            },
            "pun_master": {
                "name": "é›™é—œèªå¤§å¸«",
                "description": "è§¸ç™¼äº†æ‰€æœ‰è¬è–ç¯€é›™é—œèª",
                "icon": "ğŸ˜„",
                "rarity": "epic",
                "condition": "all_puns_triggered",
                "points": 100
            },
            "romance_expert": {
                "name": "æµªæ¼«å°ˆå®¶",
                "description": "é”æˆæ‰€æœ‰æµªæ¼«çµå±€",
                "icon": "ğŸ’˜",
                "rarity": "rare",
                "condition": "all_romance_endings",
                "points": 80
            },
            "adventure_seeker": {
                "name": "å†’éšªå°‹æ±‚è€…",
                "description": "å˜—è©¦äº†æ‰€æœ‰å†’éšªé¸æ“‡",
                "icon": "ğŸ—¡ï¸",
                "rarity": "rare",
                "condition": "all_adventure_choices",
                "points": 70
            },
            "halloween_legend": {
                "name": "è¬è–ç¯€å‚³å¥‡",
                "description": "ç²å¾— 1000 åˆ†ä»¥ä¸Š",
                "icon": "ğŸƒğŸ‘‘",
                "rarity": "legendary",
                "condition": "score_1000_plus",
                "points": 300
            }
        };

        // å¾½ç« è³‡æ–™
        const badgesData = {
            "first_play": {
                "name": "åˆä¾†ä¹åˆ°",
                "description": "ç¬¬ä¸€æ¬¡éŠç©",
                "icon": "ğŸ‘¶",
                "rarity": "common"
            },
            "night_owl": {
                "name": "å¤œè²“å­",
                "description": "åœ¨æ·±å¤œæ™‚åˆ†éŠç©",
                "icon": "ğŸ¦‰",
                "rarity": "common"
            },
            "early_bird": {
                "name": "æ—©èµ·é³¥",
                "description": "åœ¨æ¸…æ™¨æ™‚åˆ†éŠç©",
                "icon": "ğŸ¦",
                "rarity": "common"
            },
            "weekend_warrior": {
                "name": "é€±æœ«æˆ°å£«",
                "description": "åœ¨é€±æœ«éŠç©",
                "icon": "âš”ï¸",
                "rarity": "common"
            },
            "repeat_player": {
                "name": "é‡è¤‡ç©å®¶",
                "description": "éŠç©è¶…é 5 æ¬¡",
                "icon": "ğŸ”„",
                "rarity": "rare"
            },
            "social_butterfly": {
                "name": "ç¤¾äº¤è´è¶",
                "description": "åˆ†äº«äº† 3 æ¬¡æˆå°±",
                "icon": "ğŸ¦‹",
                "rarity": "rare"
            },
            "perfectionist": {
                "name": "å®Œç¾ä¸»ç¾©è€…",
                "description": "å–®æ¬¡éŠæˆ²ç²å¾—æ»¿åˆ†",
                "icon": "ğŸ’¯",
                "rarity": "epic"
            },
            "lucky_charm": {
                "name": "å¹¸é‹ç¬¦",
                "description": "é€£çºŒ 3 æ¬¡ç²å¾—ç¨€æœ‰æˆå°±",
                "icon": "ğŸ€",
                "rarity": "epic"
            },
            "halloween_spirit": {
                "name": "è¬è–ç¯€ç²¾ç¥",
                "description": "åœ¨è¬è–ç¯€æœŸé–“éŠç©",
                "icon": "ğŸƒ",
                "rarity": "rare"
            },
            "midnight_magic": {
                "name": "åˆå¤œé­”æ³•",
                "description": "åœ¨åˆå¤œæ™‚åˆ†å®ŒæˆéŠæˆ²",
                "icon": "ğŸ•›",
                "rarity": "rare"
            }
        };

        // ç¤¾äº¤å¹³å°è³‡æ–™
        const socialPlatforms = {
            "twitter": {
                "name": "Twitter",
                "icon": "ğŸ¦",
                "url": "https://twitter.com/intent/tweet",
                "hashtags": ["TsextAdventure", "HalloweenHaunt", "NSFWGame"]
            },
            "facebook": {
                "name": "Facebook",
                "icon": "ğŸ“˜",
                "url": "https://www.facebook.com/sharer/sharer.php",
                "hashtags": ["TsextAdventure", "HalloweenHaunt"]
            },
            "instagram": {
                "name": "Instagram",
                "icon": "ğŸ“·",
                "url": "https://www.instagram.com/",
                "hashtags": ["#TsextAdventure", "#HalloweenHaunt", "#NSFWGame"]
            },
            "threads": {
                "name": "Threads",
                "icon": "ğŸ§µ",
                "url": "https://www.threads.net/intent/post",
                "hashtags": ["#TsextAdventure", "#HalloweenHaunt"]
            },
            "line": {
                "name": "LINE",
                "icon": "ğŸ’¬",
                "url": "https://social-plugins.line.me/lineit/share",
                "hashtags": ["TsextAdventure", "HalloweenHaunt"]
            },
            "discord": {
                "name": "Discord",
                "icon": "ğŸ’¬",
                "url": "https://discord.com/",
                "hashtags": ["TsextAdventure", "HalloweenHaunt"]
            },
            "reddit": {
                "name": "Reddit",
                "icon": "ğŸ¤–",
                "url": "https://reddit.com/submit",
                "hashtags": ["TsextAdventure", "HalloweenHaunt", "NSFWGame"]
            },
            "telegram": {
                "name": "Telegram",
                "icon": "âœˆï¸",
                "url": "https://t.me/share/url",
                "hashtags": ["TsextAdventure", "HalloweenHaunt"]
            }
        };

        // æ•…äº‹è³‡æ–™
        const storyData = {
            "start": {
                "title": "è¬è–ç¯€éˆç•°ç´„æœƒè¶´å…¥å£",
                "description": "ä½ ç«™åœ¨ä¸€æ£Ÿé™°æ£®çš„è€å®…å‰ï¼Œé–€å£æ›è‘—ã€Œæ­¡è¿åƒåŠ è¬è–ç¯€éˆç•°ç´„æœƒè¶´ã€çš„ç‰Œå­ã€‚æœˆå…‰é€éçƒé›²ç‘ä¸‹ï¼Œå—ç“œç‡ˆåœ¨é¢¨ä¸­æ–æ›³ï¼Œç™¼å‡ºè©­ç•°çš„å…‰èŠ’ã€‚\n\nä½ è½åˆ°å±‹å…§å‚³ä¾†ç¬‘è²ã€éŸ³æ¨‚è²ï¼Œé‚„æœ‰ä¸€äº›... å¥‡æ€ªçš„è²éŸ³ã€‚é–€å£ç«™è‘—ä¸€å€‹ç©¿è‘—æ€§æ„Ÿå¥³å·«è£çš„æ¥å¾…å“¡ï¼Œå¥¹å°ä½ çœ¨äº†çœ¨çœ¼ã€‚",
                "choices": [
                    {"option": "A: å°å¥³å·«èªªã€Œä½ çš„æƒå¸šçœŸæ¼‚äº®ï¼Œèƒ½é¨å—ï¼Ÿã€", "next_scene": "witch_encounter"},
                    {"option": "B: ç›´æ¥é€²å…¥é¬¼å±‹æ¢éšª", "next_scene": "haunted_house"},
                    {"option": "C: å…ˆå»å—ç“œç”°çœ‹çœ‹", "next_scene": "pumpkin_patch"}
                ]
            },
            "witch_encounter": {
                "title": "å¥³å·«çš„èª˜æƒ‘",
                "description": "å¥³å·«å’¯å’¯ç¬‘è‘—èªªï¼šã€Œç•¶ç„¶å¯ä»¥é¨ï¼Œä½†ä½ è¦å°å¿ƒä¸è¦è¢«æƒå¸šæŸ„... ä½ çŸ¥é“çš„ã€‚ã€å¥¹æ®äº†æ®æ‰‹ï¼Œæƒå¸šçªç„¶é£›åˆ°ä½ é¢å‰ã€‚\n\nã€Œä¸éï¼Œã€å¥¹ç¥ç§˜åœ°ç¬‘è‘—ï¼Œã€Œæˆ‘çš„æƒå¸šå¾ˆæŒ‘å‰”ï¼Œåªæœ‰çœŸæ­£å‹‡æ•¢çš„äººæ‰èƒ½é§•é¦­å®ƒã€‚ã€",
                "choices": [
                    {"option": "A: å‹‡æ•¢åœ°è·¨ä¸Šæƒå¸š", "next_scene": "broom_ride_success"},
                    {"option": "B: èªªã€Œæˆ‘æ›´æƒ³é¨ä½ ã€", "next_scene": "witch_rejection"},
                    {"option": "C: å•ã€Œä½ çš„è²“å’ªåœ¨å“ªè£¡ï¼Ÿã€", "next_scene": "cat_encounter"}
                ]
            },
            "broom_ride_success": {
                "title": "æƒå¸šé£›è¡ŒæˆåŠŸ",
                "description": "ä½ æˆåŠŸè·¨ä¸Šæƒå¸šï¼Œå®ƒè¼‰è‘—ä½ åœ¨æœˆå…‰ä¸‹é£›ç¿”ï¼å¥³å·«åœ¨ä¸‹é¢é¼“æŒï¼šã€Œå¤ªæ£’äº†ï¼ä½ æ˜¯æˆ‘è¦‹éæœ€å‹‡æ•¢çš„é¨å£«ï¼ã€\n\nä½ å€‘ä¸€èµ·é£›åˆ°å±‹é ‚ï¼Œçœ‹è‘—ä¸‹é¢çš„æ´¾å°ã€‚å¥³å·«é è¿‘ä½ ï¼Œè¼•è²èªªï¼šã€Œç¾åœ¨... è®“æˆ‘å€‘åšä¸€äº›æ›´åˆºæ¿€çš„äº‹æƒ…ã€‚ã€",
                "choices": [
                    {"option": "A: åœ¨å±‹é ‚ä¸Šè¦ªå»å¥³å·«", "next_scene": "rooftop_romance"},
                    {"option": "B: æè­°ä¸€èµ·é£›åˆ°æ›´é çš„åœ°æ–¹", "next_scene": "moonlight_adventure"}
                ]
            },
            "rooftop_romance": {
                "title": "å±‹é ‚æµªæ¼«",
                "description": "åœ¨æœˆå…‰ä¸‹ï¼Œä½ å’Œå¥³å·«åœ¨å±‹é ‚ä¸Šæ“å»ã€‚å¥¹çš„å˜´å”‡æº«æš–è€Œç”œèœœï¼Œå¸¶è‘—é­”æ³•çš„å‘³é“ã€‚çªç„¶ï¼Œå¥¹æ¨é–‹ä½ ï¼Œç¬‘è‘—èªªï¼šã€Œç¾åœ¨è®“æˆ‘å€‘åšä¸€äº›çœŸæ­£çš„é­”æ³•ï¼ã€\n\nå¥¹æ®å‹•é­”æ–ï¼Œä½ å€‘å‘¨åœå‡ºç¾äº†é–ƒçˆçš„æ˜Ÿæ˜Ÿï¼Œæ•´å€‹ä¸–ç•Œéƒ½è®Šå¾—æµªæ¼«èµ·ä¾†ã€‚",
                "is_ending": true,
                "outcome": "ğŸ‰ å®Œç¾çµå±€ï¼ä½ å’Œå¥³å·«åœ¨é­”æ³•æ˜Ÿå…‰ä¸‹åº¦éäº†é›£å¿˜çš„è¬è–ç¯€å¤œæ™šï¼\n\nä½ ç²å¾—äº†ã€é­”æ³•é¨å£«ã€çš„ç¨±è™Ÿï¼Œä¸¦ä¸”å­¸æœƒäº†çœŸæ­£çš„æ„›æƒ…é­”æ³•ã€‚",
                "score": 100
            },
            "moonlight_adventure": {
                "title": "æœˆå…‰å†’éšª",
                "description": "ä½ å€‘é£›åˆ°æ›´é çš„åœ°æ–¹ï¼Œä¾†åˆ°ä¸€å€‹éš±ç§˜çš„æœˆå…‰æ¹–ã€‚å¥³å·«èªªï¼šã€Œé€™è£¡æ˜¯æˆ‘çš„ç§˜å¯†èŠ±åœ’ï¼Œåªæœ‰çœŸæ­£ç‰¹åˆ¥çš„äººæ‰èƒ½ä¾†åˆ°é€™è£¡ã€‚ã€\n\nåœ¨æœˆå…‰ä¸‹ï¼Œä½ å€‘ä¸€èµ·æ¢ç´¢è‘—å½¼æ­¤çš„å…§å¿ƒï¼Œåº¦éäº†æœ€æµªæ¼«çš„å¤œæ™šã€‚",
                "is_ending": true,
                "outcome": "ğŸŒ™ æµªæ¼«çµå±€ï¼ä½ å’Œå¥³å·«åœ¨æœˆå…‰æ¹–åº¦éäº†æœ€ç¾å¥½çš„æ™‚å…‰ï¼\n\nä½ ç²å¾—äº†ã€æœˆå…‰æˆ€äººã€çš„ç¨±è™Ÿï¼Œä¸¦ä¸”æ°¸é è¨˜ä½äº†é€™å€‹ç¥å¥‡çš„å¤œæ™šã€‚",
                "score": 90
            },
            "witch_rejection": {
                "title": "å¥³å·«çš„æ‹’çµ•",
                "description": "å¥³å·«çšºèµ·çœ‰é ­ï¼šã€Œä½ ä»¥ç‚ºæˆ‘æ˜¯ä»€éº¼ï¼Ÿéš¨ä¾¿çš„å¥³å·«å—ï¼Ÿã€å¥¹æ®å‹•é­”æ–ï¼Œä½ çªç„¶æ„Ÿè¦ºèº«é«”è®Šè¼•äº†...\n\nã€Œæ—¢ç„¶ä½ é€™éº¼ç„¡ç¦®ï¼Œå°±è®“ä½ é«”é©—ä¸€ä¸‹çœŸæ­£çš„ã€è¼•å¦‚ç¾½æ¯›ã€å§ï¼ã€ä½ é–‹å§‹é£„æµ®åœ¨ç©ºä¸­ï¼Œç„¡æ³•æ§åˆ¶æ–¹å‘ã€‚",
                "choices": [
                    {"option": "A: é“æ­‰ä¸¦è«‹æ±‚åŸè«’", "next_scene": "apology_accepted"},
                    {"option": "B: è©¦åœ–æŠ“ä½ä»€éº¼æ±è¥¿", "next_scene": "floating_mischief"}
                ]
            },
            "floating_mischief": {
                "title": "æ¼‚æµ®æƒ¡ä½œåŠ‡",
                "description": "ä½ è©¦åœ–æŠ“ä½ä»€éº¼æ±è¥¿ï¼Œä½†åªèƒ½åœ¨ç©ºä¸­é£„æµ®ã€‚å¥³å·«åœ¨ä¸‹é¢ç¬‘è‘—ï¼šã€Œé€™å°±æ˜¯ç„¡ç¦®çš„ä»£åƒ¹ï¼ã€\n\nçªç„¶ï¼Œä½ æ’åˆ°äº†ä¸€å€‹åŠç‡ˆï¼Œç‡ˆæ³¡çˆ†è£‚ï¼Œç«èŠ±å››æ¿ºã€‚å¥³å·«é©šå«ï¼šã€Œæˆ‘çš„å¤©ï¼å¿«ä¸‹ä¾†ï¼ã€å¥¹æ®å‹•é­”æ–ï¼Œä½ å®‰å…¨åœ°é™è½åˆ°åœ°é¢ã€‚",
                "is_ending": true,
                "outcome": "ğŸ’¥ æç¬‘çµå±€ï¼ä½ å› ç‚ºç„¡ç¦®è€Œæ¼‚æµ®ï¼Œæœ€å¾Œæ’å£äº†åŠç‡ˆï¼\n\né›–ç„¶çµå±€æœ‰é»å°·å°¬ï¼Œä½†è‡³å°‘ä½ å­¸æœƒäº†å°å¥³å·«è¦æœ‰ç¦®è²Œã€‚",
                "score": 30
            },
            "haunted_house": {
                "title": "é¬¼å±‹å…§éƒ¨",
                "description": "ä½ èµ°é€²é¬¼å±‹ï¼Œè£¡é¢ç‡ˆå…‰æ˜æš—ï¼Œç‰†ä¸Šæ›è‘—å¤è€çš„ç•«åƒã€‚çªç„¶ï¼Œä¸€å€‹åŠé€æ˜çš„é¬¼é­‚å¾ç‰†å£ä¸­é£„å‡ºä¾†ï¼\n\nã€Œæ­¡è¿ä¾†åˆ°æˆ‘çš„å®¶ï¼Œã€é¬¼é­‚èªªï¼Œã€Œæˆ‘æ˜¯é€™è£¡çš„ä¸»äººï¼Œå·²ç¶“æ­»äº† 200 å¹´äº†ã€‚ä½†æˆ‘é‚„æ˜¯å¾ˆ... æ´»èºã€‚ã€ä»–å°ä½ çœ¨äº†çœ¨çœ¼ã€‚",
                "choices": [
                    {"option": "A: èªªã€Œä½ çœ‹èµ·ä¾†å¾ˆå¯‚å¯ã€", "next_scene": "ghost_romance"},
                    {"option": "B: å•ã€Œä½ èƒ½è§¸æ‘¸å¯¦é«”å—ï¼Ÿã€", "next_scene": "ghost_touch"},
                    {"option": "C: è©¦åœ–é€ƒè·‘", "next_scene": "ghost_chase"}
                ]
            },
            "ghost_romance": {
                "title": "é¬¼é­‚çš„æµªæ¼«",
                "description": "é¬¼é­‚å˜†äº†å£æ°£ï¼šã€Œæ˜¯çš„ï¼Œæˆ‘ç¢ºå¯¦å¾ˆå¯‚å¯ã€‚200 å¹´ä¾†ï¼Œæ²’æœ‰äººé¡˜æ„å’Œæˆ‘... ä½ çŸ¥é“çš„ã€‚ã€ä»–çš„è²éŸ³å¸¶è‘—æ¸´æœ›ã€‚\n\nã€Œä½†æ˜¯ï¼Œã€ä»–çªç„¶èˆˆå¥®åœ°èªªï¼Œã€Œå¦‚æœä½ é¡˜æ„ï¼Œæˆ‘å¯ä»¥æ•™ä½ ä¸€äº›é¬¼é­‚çš„... ç‰¹æ®ŠæŠ€å·§ã€‚ã€",
                "choices": [
                    {"option": "A: èªªã€Œæˆ‘å¾ˆæ„Ÿèˆˆè¶£ã€", "next_scene": "ghost_lessons"},
                    {"option": "B: å•ã€Œæœƒä¸æœƒå¾ˆå†·ï¼Ÿã€", "next_scene": "cold_encounter"}
                ]
            },
            "cold_encounter": {
                "title": "å†°å†·çš„ç›¸é‡",
                "description": "é¬¼é­‚ç¬‘è‘—èªªï¼šã€Œä¸€é–‹å§‹æœƒæœ‰é»å†·ï¼Œä½†å¾ˆå¿«å°±æœƒè®Šæš–çš„ã€‚è®“æˆ‘ç¤ºç¯„çµ¦ä½ çœ‹...ã€\n\nä»–è¼•è¼•è§¸æ‘¸ä½ çš„æ‰‹ï¼Œä½ æ„Ÿè¦ºåˆ°ä¸€é™£æ¶¼æ„ï¼Œä½†åŒæ™‚åˆæœ‰ä¸€ç¨®å¥‡ç•°çš„æº«æš–ã€‚ä»–çš„è§¸æ‘¸è®“ä½ æ„Ÿåˆ°æ—¢åˆºæ¿€åˆèˆ’é©ã€‚",
                "is_ending": true,
                "outcome": "â„ï¸ å†°å†·çµå±€ï¼ä½ å’Œé¬¼é­‚åº¦éäº†å¥‡ç•°çš„å¤œæ™šï¼\n\né›–ç„¶æœ‰é»å†·ï¼Œä½†ä½ é«”é©—åˆ°äº†å‰æ‰€æœªæœ‰çš„æ„Ÿè¦ºã€‚",
                "score": 70
            },
            "pumpkin_patch": {
                "title": "å—ç“œç”°çš„èª˜æƒ‘",
                "description": "ä½ ä¾†åˆ°å—ç“œç”°ï¼Œæœˆå…‰ä¸‹çš„å¤§å—ç“œçœ‹èµ·ä¾†æ ¼å¤–èª˜äººã€‚çªç„¶ï¼Œä¸€å€‹ç©¿è‘—è¾²å¤«è£çš„æ€§æ„Ÿå¥³éƒå¾å—ç“œå¾Œé¢èµ°å‡ºä¾†ã€‚\n\nã€Œæ­¡è¿ä¾†åˆ°æˆ‘çš„å—ç“œç”°ï¼Œã€å¥¹èªªï¼Œã€Œæˆ‘æ˜¯é€™è£¡çš„å®ˆè­·è€…ã€‚é€™äº›å—ç“œéƒ½å¾ˆç‰¹åˆ¥... å®ƒå€‘æœƒå›æ‡‰ä½ çš„æ…¾æœ›ã€‚ã€",
                "choices": [
                    {"option": "A: å•ã€Œå—ç“œæœƒå›æ‡‰ä»€éº¼æ…¾æœ›ï¼Ÿã€", "next_scene": "pumpkin_magic"},
                    {"option": "B: èªªã€Œæˆ‘æ›´æƒ³äº†è§£ä½ ã€", "next_scene": "farmer_romance"}
                ]
            },
            "farmer_romance": {
                "title": "è¾²å¤«çš„æµªæ¼«",
                "description": "è¾²å¤«å¥³éƒå°ä½ çš„ç›´æ¥æ„Ÿåˆ°é©šè¨ï¼Œç„¶å¾Œç¬‘äº†ã€‚ã€Œä½ å¾ˆæœ‰è¶£ï¼Œã€å¥¹èªªï¼Œã€Œæˆ‘å–œæ­¡ç›´æ¥çš„äººã€‚ã€\n\nå¥¹é è¿‘ä½ ï¼Œè¼•è²èªªï¼šã€Œé‚£éº¼ï¼Œä½ æƒ³è¦äº†è§£æˆ‘çš„å“ªå€‹æ–¹é¢å‘¢ï¼Ÿã€å¥¹çš„çœ¼ç›é–ƒçˆè‘—èª˜æƒ‘çš„å…‰èŠ’ã€‚",
                "choices": [
                    {"option": "A: èªªã€Œæˆ‘æƒ³äº†è§£ä½ çš„å¿ƒã€", "next_scene": "heart_to_heart"},
                    {"option": "B: èªªã€Œæˆ‘æƒ³äº†è§£ä½ çš„èº«é«”ã€", "next_scene": "physical_attraction"}
                ]
            },
            "heart_to_heart": {
                "title": "å¿ƒéˆäº¤æµ",
                "description": "è¾²å¤«å¥³éƒå°ä½ çš„å›ç­”æ„Ÿåˆ°æ„Ÿå‹•ã€‚ã€Œä½ æ˜¯ä¸€å€‹çœŸæ­£çš„äººï¼Œã€å¥¹èªªï¼Œã€Œæˆ‘é¡˜æ„å’Œä½ åˆ†äº«æˆ‘çš„å…§å¿ƒã€‚ã€\n\nä½ å€‘ååœ¨å—ç“œç”°é‚Šï¼Œåˆ†äº«è‘—å½¼æ­¤çš„æ•…äº‹å’Œå¤¢æƒ³ï¼Œåº¦éäº†æœ€ç¾å¥½çš„æ™‚å…‰ã€‚",
                "is_ending": true,
                "outcome": "ğŸ’• å¿ƒéˆçµå±€ï¼ä½ å’Œè¾²å¤«å¥³éƒå»ºç«‹äº†æ·±åšçš„æƒ…æ„Ÿé€£æ¥ï¼\n\nä½ ç²å¾—äº†ã€å¿ƒéˆä¼´ä¾¶ã€çš„ç¨±è™Ÿï¼Œä¸¦ä¸”æ°¸é è¨˜ä½äº†é€™å€‹ç¾å¥½çš„å¤œæ™šã€‚",
                "score": 85
            },
            "physical_attraction": {
                "title": "èº«é«”å¸å¼•",
                "description": "è¾²å¤«å¥³éƒå°ä½ çš„ç›´æ¥æ„Ÿåˆ°èˆˆå¥®ã€‚ã€Œå¾ˆå¥½ï¼Œã€å¥¹èªªï¼Œã€Œæˆ‘å–œæ­¡èª å¯¦çš„äººã€‚ã€\n\nå¥¹æ‹‰è‘—ä½ çš„æ‰‹ï¼Œå¸¶ä½ åˆ°å—ç“œç”°çš„æ·±è™•ã€‚ã€Œè®“æˆ‘å€‘åšä¸€äº›çœŸæ­£æœ‰è¶£çš„äº‹æƒ…ï¼Œã€å¥¹è¼•è²èªªã€‚",
                "is_ending": true,
                "outcome": "ğŸ”¥ æ¿€æƒ…çµå±€ï¼ä½ å’Œè¾²å¤«å¥³éƒåº¦éäº†ç«ç†±çš„å¤œæ™šï¼\n\nä½ ç²å¾—äº†ã€æ¿€æƒ…æˆ€äººã€çš„ç¨±è™Ÿï¼Œä¸¦ä¸”æ°¸é è¨˜ä½äº†é€™å€‹å……æ»¿æ¿€æƒ…çš„å¤œæ™šã€‚",
                "score": 90
            }
        };

        // è¼‰å…¥éŠæˆ²è³‡æ–™
        function loadGameData() {
            const saved = localStorage.getItem('tsextAdventureData');
            if (saved) {
                const data = JSON.parse(saved);
                gameState.unlockedAchievements = new Set(data.unlockedAchievements || []);
                gameState.unlockedBadges = new Set(data.unlockedBadges || []);
                gameState.playCount = data.playCount || 0;
                gameState.totalScore = data.totalScore || 0;
                gameState.allEndingsUnlocked = new Set(data.allEndingsUnlocked || []);
                gameState.allScenesVisited = new Set(data.allScenesVisited || []);
                gameState.punsTriggered = new Set(data.punsTriggered || []);
            }
        }

        // å„²å­˜éŠæˆ²è³‡æ–™
        function saveGameData() {
            const data = {
                unlockedAchievements: Array.from(gameState.unlockedAchievements),
                unlockedBadges: Array.from(gameState.unlockedBadges),
                playCount: gameState.playCount,
                totalScore: gameState.totalScore,
                allEndingsUnlocked: Array.from(gameState.allEndingsUnlocked),
                allScenesVisited: Array.from(gameState.allScenesVisited),
                punsTriggered: Array.from(gameState.punsTriggered)
            };
            localStorage.setItem('tsextAdventureData', JSON.stringify(data));
        }

        // æª¢æŸ¥æˆå°±
        function checkAchievements(sceneId) {
            const newAchievements = [];
            
            // æª¢æŸ¥çµå±€æˆå°±
            if (storyData[sceneId] && storyData[sceneId].is_ending) {
                const endingCondition = `ending_${sceneId}`;
                for (const [achievementId, achievement] of Object.entries(achievementsData)) {
                    if (achievement.condition === endingCondition && !gameState.unlockedAchievements.has(achievementId)) {
                        gameState.unlockedAchievements.add(achievementId);
                        newAchievements.push(achievementId);
                    }
                }
            }

            // æª¢æŸ¥ç‰¹æ®Šæˆå°±
            checkSpecialAchievements();

            // é¡¯ç¤ºæ–°æˆå°±
            newAchievements.forEach(achievementId => {
                showAchievementPopup(achievementId);
            });

            // æ›´æ–°æˆå°±é¢æ¿
            updateAchievementsPanel();
            updateStatsPanel();
            saveGameData();
        }

        // æª¢æŸ¥ç‰¹æ®Šæˆå°±
        function checkSpecialAchievements() {
            // æ¢ç´¢è€…æˆå°±
            if (gameState.visitedScenes.size >= 10 && !gameState.unlockedAchievements.has('explorer')) {
                gameState.unlockedAchievements.add('explorer');
                showAchievementPopup('explorer');
            }

            // å®Œç¾ä¸»ç¾©è€…æˆå°±
            if (gameState.allEndingsUnlocked.size >= 8 && !gameState.unlockedAchievements.has('completionist')) {
                gameState.unlockedAchievements.add('completionist');
                showAchievementPopup('completionist');
            }

            // é€Ÿåº¦æƒ¡é­”æˆå°±
            if (gameState.gameStartTime) {
                const playTime = (Date.now() - gameState.gameStartTime) / 1000 / 60; // åˆ†é˜
                if (playTime <= 5 && !gameState.unlockedAchievements.has('speed_demon')) {
                    gameState.unlockedAchievements.add('speed_demon');
                    showAchievementPopup('speed_demon');
                }
            }

            // è¬è–ç¯€å‚³å¥‡æˆå°±
            if (gameState.totalScore >= 1000 && !gameState.unlockedAchievements.has('halloween_legend')) {
                gameState.unlockedAchievements.add('halloween_legend');
                showAchievementPopup('halloween_legend');
            }
        }

        // æª¢æŸ¥å¾½ç« 
        function checkBadges() {
            const newBadges = [];
            const now = new Date();
            const hour = now.getHours();
            const day = now.getDay();

            // ç¬¬ä¸€æ¬¡éŠç©
            if (gameState.playCount === 1 && !gameState.unlockedBadges.has('first_play')) {
                gameState.unlockedBadges.add('first_play');
                newBadges.push('first_play');
            }

            // å¤œè²“å­
            if ((hour >= 22 || hour <= 2) && !gameState.unlockedBadges.has('night_owl')) {
                gameState.unlockedBadges.add('night_owl');
                newBadges.push('night_owl');
            }

            // æ—©èµ·é³¥
            if (hour >= 5 && hour <= 8 && !gameState.unlockedBadges.has('early_bird')) {
                gameState.unlockedBadges.add('early_bird');
                newBadges.push('early_bird');
            }

            // é€±æœ«æˆ°å£«
            if ((day === 0 || day === 6) && !gameState.unlockedBadges.has('weekend_warrior')) {
                gameState.unlockedBadges.add('weekend_warrior');
                newBadges.push('weekend_warrior');
            }

            // é‡è¤‡ç©å®¶
            if (gameState.playCount >= 5 && !gameState.unlockedBadges.has('repeat_player')) {
                gameState.unlockedBadges.add('repeat_player');
                newBadges.push('repeat_player');
            }

            // åˆå¤œé­”æ³•
            if (hour === 0 && !gameState.unlockedBadges.has('midnight_magic')) {
                gameState.unlockedBadges.add('midnight_magic');
                newBadges.push('midnight_magic');
            }

            return newBadges;
        }

        // é¡¯ç¤ºæˆå°±å½ˆçª—
        function showAchievementPopup(achievementId) {
            const achievement = achievementsData[achievementId];
            if (!achievement) return;

            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.onclick = () => closeAchievementPopup();

            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-title">ğŸ† æˆå°±è§£é–ï¼</div>
                <div class="achievement-description">${achievement.name}</div>
                <div class="achievement-rarity rarity-${achievement.rarity}">${achievement.rarity.toUpperCase()}</div>
                <div class="achievement-description">${achievement.description}</div>
                <div class="achievement-actions">
                    <button class="share-btn" onclick="downloadAchievementImage('${achievementId}')">ä¸‹è¼‰åœ–ç‰‡ ğŸ“¥</button>
                    <button class="share-btn" onclick="shareAchievement('${achievementId}')">åˆ†äº«æˆå°± ğŸ“¤</button>
                    <button class="close-btn" onclick="closeAchievementPopup()">é—œé–‰</button>
                </div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(popup);

            // 3ç§’å¾Œè‡ªå‹•é—œé–‰
            setTimeout(() => {
                if (document.body.contains(popup)) {
                    closeAchievementPopup();
                }
            }, 5000);
        }

        // é—œé–‰æˆå°±å½ˆçª—
        function closeAchievementPopup() {
            const overlay = document.querySelector('.overlay');
            const popup = document.querySelector('.achievement-popup');
            if (overlay) overlay.remove();
            if (popup) popup.remove();
        }

        // åˆ†äº«æˆå°±
        function shareAchievement(achievementId) {
            const achievement = achievementsData[achievementId];
            const shareText = `ğŸƒ æˆ‘åœ¨ Tsext Adventure: Halloween Haunt ä¸­è§£é–äº†æˆå°±ã€Œ${achievement.name}ã€ï¼\n\n${achievement.description}\n\n#TsextAdventure #HalloweenHaunt #NSFWGame`;
            const shareUrl = window.location.href;

            showShareModal(shareText, shareUrl, achievement);
        }

        // ä¸‹è¼‰æˆå°±åœ–ç‰‡
        function downloadAchievementImage(achievementId) {
            const achievement = achievementsData[achievementId];
            if (!achievement) return;

            // å‰µå»º canvas å…ƒç´ 
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // è¨­å®š canvas å°ºå¯¸ (ç¤¾äº¤åª’é«”é©ç”¨å°ºå¯¸)
            canvas.width = 800;
            canvas.height = 600;

            // å‰µå»ºæ¼¸å±¤èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#1a1a2e');
            gradient.addColorStop(0.5, '#16213e');
            gradient.addColorStop(1, '#0f3460');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ·»åŠ é‚Šæ¡†æ•ˆæœ
            ctx.strokeStyle = '#ff6b35';
            ctx.lineWidth = 8;
            ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

            // å…§å±¤é‚Šæ¡†
            ctx.strokeStyle = 'rgba(139, 92, 246, 0.8)';
            ctx.lineWidth = 4;
            ctx.strokeRect(40, 40, canvas.width - 80, canvas.height - 80);

            // éŠæˆ²æ¨™é¡Œ
            ctx.fillStyle = '#ff6b35';
            ctx.font = 'bold 32px "Courier New", monospace';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸƒ Tsext Adventure: Halloween Haunt ğŸƒ', canvas.width / 2, 100);

            // æˆå°±è§£é–æ–‡å­—
            ctx.fillStyle = '#8b5cf6';
            ctx.font = 'bold 24px "Courier New", monospace';
            ctx.fillText('ğŸ† æˆå°±è§£é–ï¼', canvas.width / 2, 150);

            // æˆå°±åœ–æ¨™ (æ”¾å¤§)
            ctx.font = '120px Arial';
            ctx.fillText(achievement.icon, canvas.width / 2, 280);

            // æˆå°±åç¨±
            ctx.fillStyle = '#ff6b35';
            ctx.font = 'bold 36px "Courier New", monospace';
            ctx.fillText(achievement.name, canvas.width / 2, 350);

            // ç¨€æœ‰åº¦æ¨™ç±¤
            const rarityColors = {
                'common': '#9CA3AF',
                'rare': '#3B82F6', 
                'epic': '#8B5CF6',
                'legendary': '#F59E0B'
            };
            
            ctx.fillStyle = rarityColors[achievement.rarity] || '#9CA3AF';
            ctx.font = 'bold 20px "Courier New", monospace';
            ctx.fillText(`ã€ ${achievement.rarity.toUpperCase()} ã€‘`, canvas.width / 2, 390);

            // æˆå°±æè¿° (è‡ªå‹•æ›è¡Œ)
            ctx.fillStyle = '#e0e0e0';
            ctx.font = '18px "Courier New", monospace';
            const maxWidth = canvas.width - 120;
            const lineHeight = 25;
            const words = achievement.description.split('');
            let line = '';
            let y = 440;

            for (let i = 0; i < words.length; i++) {
                const testLine = line + words[i];
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                
                if (testWidth > maxWidth && i > 0) {
                    ctx.fillText(line, canvas.width / 2, y);
                    line = words[i];
                    y += lineHeight;
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, canvas.width / 2, y);

            // åˆ†æ•¸è³‡è¨Š
            if (achievement.points) {
                ctx.fillStyle = '#ffd700';
                ctx.font = 'bold 20px "Courier New", monospace';
                ctx.fillText(`ğŸ’ ${achievement.points} åˆ†`, canvas.width / 2, y + 50);
            }

            // åº•éƒ¨è£é£¾
            ctx.fillStyle = '#8b5cf6';
            ctx.font = '16px "Courier New", monospace';
            ctx.fillText('github.com/dennislee928/tsext-adventure', canvas.width / 2, canvas.height - 50);

            // ä¸‹è¼‰åœ–ç‰‡
            const link = document.createElement('a');
            link.download = `tsext-adventure-achievement-${achievement.name.replace(/[^a-zA-Z0-9]/g, '_')}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();

            // é¡¯ç¤ºæˆåŠŸæç¤º
            showSuccessNotification(`ğŸ‰ æˆå°±åœ–ç‰‡å·²ä¸‹è¼‰ï¼š${achievement.name}`);
        }

        // é¡¯ç¤ºæˆåŠŸé€šçŸ¥
        function showSuccessNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
                z-index: 10000;
                font-family: 'Courier New', monospace;
                font-weight: bold;
                animation: slideInRight 0.3s ease-out;
            `;
            notification.textContent = message;
            
            // æ·»åŠ å‹•ç•«æ¨£å¼
            if (!document.getElementById('notification-style')) {
                const style = document.createElement('style');
                style.id = 'notification-style';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(notification);

            // 3 ç§’å¾Œè‡ªå‹•ç§»é™¤
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // é¡¯ç¤ºåˆ†äº«æ¨¡æ…‹æ¡†
        function showShareModal(text, url, achievement) {
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.onclick = () => closeShareModal();

            const modal = document.createElement('div');
            modal.className = 'achievement-popup';
            modal.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-title">åˆ†äº«æˆå°±</div>
                <div class="achievement-description">é¸æ“‡åˆ†äº«å¹³å°ï¼š</div>
                <div class="achievement-actions">
                    ${Object.entries(socialPlatforms).map(([platformId, platform]) => `
                        <button class="share-btn" onclick="shareToPlatform('${platformId}', '${encodeURIComponent(text)}', '${encodeURIComponent(url)}')">
                            ${platform.icon} ${platform.name}
                        </button>
                    `).join('')}
                    <button class="close-btn" onclick="closeShareModal()">å–æ¶ˆ</button>
                </div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(modal);
        }

        // é—œé–‰åˆ†äº«æ¨¡æ…‹æ¡†
        function closeShareModal() {
            const overlay = document.querySelector('.overlay');
            const modal = document.querySelector('.achievement-popup');
            if (overlay) overlay.remove();
            if (modal) modal.remove();
        }

        // åˆ†äº«åˆ°å¹³å°
        function shareToPlatform(platformId, text, url) {
            const platform = socialPlatforms[platformId];
            let shareUrl = '';

            switch (platformId) {
                case 'twitter':
                    shareUrl = `${platform.url}?text=${text}&url=${url}`;
                    break;
                case 'facebook':
                    shareUrl = `${platform.url}?u=${url}&quote=${text}`;
                    break;
                case 'instagram':
                    // Instagram éœ€è¦æ‰‹å‹•è¤‡è£½
                    navigator.clipboard.writeText(`${text}\n\n${url}`);
                    alert('å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼è«‹åœ¨ Instagram ä¸­è²¼ä¸Šã€‚');
                    return;
                case 'threads':
                    shareUrl = `${platform.url}?text=${text}`;
                    break;
                case 'line':
                    shareUrl = `${platform.url}?url=${url}&text=${text}`;
                    break;
                case 'reddit':
                    shareUrl = `${platform.url}?url=${url}&title=${text}`;
                    break;
                case 'telegram':
                    shareUrl = `${platform.url}?url=${url}&text=${text}`;
                    break;
                default:
                    // è¤‡è£½åˆ°å‰ªè²¼æ¿
                    navigator.clipboard.writeText(`${text}\n\n${url}`);
                    alert('å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
                    return;
            }

            window.open(shareUrl, '_blank', 'width=600,height=400');
            closeShareModal();
        }

        // åˆ‡æ›æˆå°±é¢æ¿
        function toggleAchievementsPanel() {
            const panel = document.getElementById('achievementsPanel');
            const toggle = document.getElementById('achievementsToggle');
            
            if (panel.classList.contains('open')) {
                panel.classList.remove('open');
                if (toggle) {
                    toggle.style.right = '0';
                }
            } else {
                panel.classList.add('open');
                if (toggle) {
                    toggle.style.right = '300px';
                }
            }
        }

        // æ›´æ–°æˆå°±é¢æ¿
        function updateAchievementsPanel() {
            const panel = document.getElementById('achievementsList');
            if (!panel) return;

            const unlockedCount = gameState.unlockedAchievements.size;
            const totalCount = Object.keys(achievementsData).length;
            
            let html = `
                <div style="text-align: center; margin-bottom: 15px; padding: 10px; background: rgba(139, 92, 246, 0.2); border-radius: 8px;">
                    <div style="font-size: 1.5em; color: #ff6b35; font-weight: bold;">${unlockedCount} / ${totalCount}</div>
                    <div style="font-size: 0.9em; color: #e0e0e0;">å·²è§£é–æˆå°±</div>
                </div>
            `;

            html += Object.entries(achievementsData).map(([achievementId, achievement]) => {
                const isUnlocked = gameState.unlockedAchievements.has(achievementId);
                return `
                    <div class="achievement-item ${isUnlocked ? 'unlocked' : ''}" style="opacity: ${isUnlocked ? '1' : '0.5'}">
                        <div class="achievement-item-icon">${achievement.icon}</div>
                        <div class="achievement-item-text">
                            <div class="achievement-item-name">${achievement.name}</div>
                            <div class="achievement-item-desc">${achievement.description}</div>
                            ${isUnlocked ? '<div style="font-size: 0.7em; color: #ff6b35; margin-top: 3px;">âœ“ å·²è§£é–</div>' : '<div style="font-size: 0.7em; color: #666; margin-top: 3px;">ğŸ”’ æœªè§£é–</div>'}
                        </div>
                        ${isUnlocked ? `
                            <div class="achievement-item-actions" style="display: flex; flex-direction: column; gap: 5px; margin-left: 10px;">
                                <button onclick="downloadAchievementImage('${achievementId}')" style="background: #ff6b35; border: none; border-radius: 15px; padding: 5px 10px; color: white; font-size: 0.7em; cursor: pointer; transition: all 0.2s; min-width: 60px;" onmouseover="this.style.background='#e55a2e'" onmouseout="this.style.background='#ff6b35'">ğŸ“¥ ä¸‹è¼‰</button>
                                <button onclick="shareAchievement('${achievementId}')" style="background: #8b5cf6; border: none; border-radius: 15px; padding: 5px 10px; color: white; font-size: 0.7em; cursor: pointer; transition: all 0.2s; min-width: 60px;" onmouseover="this.style.background='#7c3aed'" onmouseout="this.style.background='#8b5cf6'">ğŸ“¤ åˆ†äº«</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            panel.innerHTML = html;
        }

        // æ›´æ–°çµ±è¨ˆé¢æ¿
        function updateStatsPanel() {
            document.getElementById('totalScore').textContent = gameState.totalScore;
            document.getElementById('playCount').textContent = gameState.playCount;
            document.getElementById('achievementCount').textContent = gameState.unlockedAchievements.size;
            document.getElementById('sceneCount').textContent = gameState.visitedScenes.size;
        }

        // é–‹å§‹éŠæˆ²
        function startGame() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('è«‹è¼¸å…¥ä½ çš„åå­—ï¼');
                return;
            }

            gameState.playerName = playerName;
            gameState.currentScene = 'start';
            gameState.score = 0;
            gameState.visitedScenes.clear();
            gameState.gameStartTime = Date.now();
            gameState.playCount++;

            // æª¢æŸ¥å¾½ç« 
            const newBadges = checkBadges();
            if (newBadges.length > 0) {
                newBadges.forEach(badgeId => {
                    const badge = badgesData[badgeId];
                    alert(`ğŸ† ç²å¾—å¾½ç« ï¼š${badge.name} - ${badge.description}`);
                });
            }

            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('statsPanel').style.display = 'block';
            document.getElementById('achievementsToggle').style.display = 'block';
            
            updateStatsPanel();
            updateAchievementsPanel();
            saveGameData();
            displayScene('start');
        }

        // é¡¯ç¤ºå ´æ™¯
        function displayScene(sceneId) {
            const scene = storyData[sceneId];
            if (!scene) {
                alert('æ‰¾ä¸åˆ°å ´æ™¯è³‡æ–™ï¼');
                return;
            }

            gameState.visitedScenes.add(sceneId);
            gameState.allScenesVisited.add(sceneId);

            let html = `
                <div class="scene-title">ğŸƒ ${scene.title} ğŸƒ</div>
                <div class="scene-description">${scene.description.replace(/\n/g, '<br>')}</div>
            `;

            if (scene.is_ending) {
                gameState.score += scene.score || 0;
                gameState.totalScore += scene.score || 0;
                gameState.allEndingsUnlocked.add(sceneId);
                
                // æª¢æŸ¥æˆå°±
                checkAchievements(sceneId);

                html += `
                    <div class="ending">
                        <div class="ending-title">ğŸ­ çµå±€ï¼š${scene.title}</div>
                        <div class="ending-outcome">${scene.outcome.replace(/\n/g, '<br>')}</div>
                        <div class="score">ğŸ† ä½ çš„åˆ†æ•¸ï¼š${gameState.score}</div>
                        <div class="score">ğŸ“ æ¢ç´¢å ´æ™¯æ•¸ï¼š${gameState.visitedScenes.size}</div>
                        <div class="score">ğŸ¯ ç¸½åˆ†æ•¸ï¼š${gameState.totalScore}</div>
                        <button class="restart-btn" onclick="restartGame()">é‡æ–°é–‹å§‹ ğŸƒ</button>
                    </div>
                `;
            } else if (scene.choices) {
                html += '<div class="choices">';
                scene.choices.forEach((choice, index) => {
                    html += `
                        <div class="choice" onclick="makeChoice('${choice.next_scene}')">
                            ${choice.option}
                        </div>
                    `;
                });
                html += '</div>';
            }

            document.getElementById('gameArea').innerHTML = html;
        }

        // åšå‡ºé¸æ“‡
        function makeChoice(nextScene) {
            displayScene(nextScene);
        }

        // é‡æ–°é–‹å§‹éŠæˆ²
        function restartGame() {
            gameState.currentScene = 'start';
            gameState.score = 0;
            gameState.visitedScenes.clear();
            gameState.gameStartTime = Date.now();
            gameState.playCount++;

            // æª¢æŸ¥å¾½ç« 
            const newBadges = checkBadges();
            if (newBadges.length > 0) {
                newBadges.forEach(badgeId => {
                    const badge = badgesData[badgeId];
                    alert(`ğŸ† ç²å¾—å¾½ç« ï¼š${badge.name} - ${badge.description}`);
                });
            }

            updateStatsPanel();
            saveGameData();
            displayScene('start');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadGameData();
            updateAchievementsPanel();
            updateStatsPanel();
            console.log('ğŸƒ Tsext Adventure: Halloween Haunt å·²è¼‰å…¥ï¼');
        });
    </script>
</body>
</html>
