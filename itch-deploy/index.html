<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tsext Adventure: Halloween Haunt</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.3);
            border: 2px solid #ff6b35;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            color: #ff6b35;
            text-shadow: 0 0 10px #ff6b35;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #8b5cf6;
            margin-bottom: 20px;
        }

        .warning {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid #ff6b35;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-area {
            min-height: 400px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .scene-title {
            font-size: 1.5em;
            color: #ff6b35;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #ff6b35;
            padding-bottom: 10px;
        }

        .scene-description {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #e0e0e0;
        }

        .choices {
            margin-top: 20px;
        }

        .choice {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid #8b5cf6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .choice:hover {
            background: rgba(139, 92, 246, 0.4);
            transform: translateX(5px);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
        }

        .ending {
            text-align: center;
            padding: 20px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 10px;
            border: 2px solid #ff6b35;
        }

        .ending-title {
            font-size: 1.8em;
            color: #ff6b35;
            margin-bottom: 15px;
        }

        .ending-outcome {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .score {
            font-size: 1.1em;
            color: #8b5cf6;
            margin-bottom: 15px;
        }

        .restart-btn {
            background: linear-gradient(45deg, #ff6b35, #8b5cf6);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        .start-screen {
            text-align: center;
        }

        .player-input {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b5cf6;
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 1.1em;
            width: 100%;
            max-width: 300px;
            margin: 20px auto;
            text-align: center;
        }

        .start-btn {
            background: linear-gradient(45deg, #8b5cf6, #ff6b35);
            border: none;
            border-radius: 25px;
            padding: 15px 40px;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.5);
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.9em;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 3px solid #ff6b35;
            border-radius: 15px;
            padding: 30px;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 107, 53, 0.5);
            animation: achievementPop 0.5s ease-out;
        }

        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .achievement-icon {
            font-size: 4em;
            margin-bottom: 15px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .achievement-title {
            font-size: 1.8em;
            color: #ff6b35;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .achievement-description {
            font-size: 1.1em;
            color: #e0e0e0;
            margin-bottom: 20px;
        }

        .achievement-rarity {
            font-size: 1em;
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .rarity-common { background: #9CA3AF; color: #000; }
        .rarity-rare { background: #3B82F6; color: #fff; }
        .rarity-epic { background: #8B5CF6; color: #fff; }
        .rarity-legendary { background: #F59E0B; color: #000; }

        .achievement-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .share-btn {
            background: linear-gradient(45deg, #ff6b35, #8b5cf6);
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .share-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.5);
        }

        .close-btn {
            background: #666;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .close-btn:hover {
            background: #888;
            transform: scale(1.05);
        }

        .achievements-panel {
            position: fixed;
            top: 20px;
            right: -320px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #8b5cf6;
            border-radius: 10px 0 0 10px;
            padding: 15px;
            z-index: 100;
            max-width: 300px;
            width: 300px;
            max-height: 80vh;
            overflow-y: auto;
            transition: right 0.3s ease;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
        }

        .achievements-panel.open {
            right: 0;
        }

        .achievements-toggle {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #8b5cf6, #ff6b35);
            border: 2px solid #8b5cf6;
            border-right: none;
            border-radius: 10px 0 0 10px;
            padding: 15px 10px;
            cursor: pointer;
            z-index: 101;
            transition: all 0.3s ease;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-weight: bold;
            color: white;
            font-size: 1em;
        }

        .achievements-toggle:hover {
            padding-left: 15px;
            box-shadow: -5px 0 15px rgba(139, 92, 246, 0.5);
        }

        .achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b5cf6;
        }

        .achievements-title {
            font-size: 1.2em;
            color: #8b5cf6;
            font-weight: bold;
        }

        .achievements-close {
            background: transparent;
            border: none;
            color: #ff6b35;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .achievements-close:hover {
            background: rgba(255, 107, 53, 0.2);
            transform: rotate(90deg);
        }

        .achievement-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .achievement-item:hover {
            background: rgba(139, 92, 246, 0.2);
            transform: translateX(5px);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .achievement-item.unlocked {
            background: rgba(255, 107, 53, 0.2);
            border-color: rgba(255, 107, 53, 0.5);
        }

        .achievement-item.unlocked:hover {
            background: rgba(255, 107, 53, 0.3);
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        .achievement-item-icon {
            font-size: 2em;
            margin-right: 12px;
            min-width: 40px;
            text-align: center;
        }

        .achievement-item-text {
            flex: 1;
        }

        .achievement-item-name {
            font-size: 0.95em;
            color: #fff;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .achievement-item-desc {
            font-size: 0.8em;
            color: #ccc;
            line-height: 1.3;
        }

        .stats-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #ff6b35;
            border-radius: 10px;
            padding: 15px;
            z-index: 100;
            min-width: 200px;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.5);
        }

        .stats-title {
            font-size: 1.2em;
            color: #ff6b35;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #e0e0e0;
            padding: 5px;
            border-radius: 5px;
            background: rgba(255, 107, 53, 0.1);
        }

        .stat-item span:first-child {
            font-weight: 600;
        }

        .stat-item span:last-child {
            color: #ff6b35;
            font-weight: bold;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        .loading {
            text-align: center;
            color: #8b5cf6;
            font-size: 1.2em;
        }

        /* RWD - Âπ≥ÊùøÂíåÂ∞èËû¢Âπï */
        @media (max-width: 1024px) {
            .stats-panel {
                top: 10px;
                left: 10px;
                min-width: 150px;
                font-size: 0.9em;
            }

            .achievements-panel {
                width: 250px;
                right: -270px;
            }

            .achievements-toggle {
                font-size: 0.9em;
                padding: 12px 8px;
            }
        }

        /* RWD - ÊâãÊ©üÊ©´Âêë */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }
            
            .title {
                font-size: 1.8em;
            }

            .subtitle {
                font-size: 1em;
            }
            
            .scene-title {
                font-size: 1.2em;
            }

            .scene-description {
                font-size: 1em;
            }

            .choice {
                font-size: 0.95em;
                padding: 12px;
            }

            .stats-panel {
                top: 10px;
                left: 10px;
                min-width: 120px;
                font-size: 0.85em;
                padding: 10px;
            }

            .stats-title {
                font-size: 1em;
            }

            .stat-item {
                font-size: 0.85em;
                margin-bottom: 5px;
            }

            .achievements-panel {
                width: 220px;
                right: -240px;
                max-height: 70vh;
            }

            .achievements-toggle {
                font-size: 0.85em;
                padding: 10px 6px;
            }

            .achievement-popup {
                width: 90%;
                max-width: 350px;
                padding: 20px;
            }

            .achievement-icon {
                font-size: 3em;
            }

            .achievement-title {
                font-size: 1.5em;
            }

            .share-btn, .close-btn {
                font-size: 0.9em;
                padding: 8px 15px;
            }
        }

        /* RWD - ÊâãÊ©üÁõ¥Âêë */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
                margin: 5px;
            }

            .title {
                font-size: 1.5em;
            }

            .subtitle {
                font-size: 0.9em;
            }

            .warning {
                font-size: 0.9em;
                padding: 10px;
            }

            .scene-title {
                font-size: 1.1em;
            }

            .scene-description {
                font-size: 0.95em;
            }

            .choice {
                font-size: 0.9em;
                padding: 10px;
            }

            .stats-panel {
                position: relative;
                top: 0;
                left: 0;
                width: 100%;
                margin-bottom: 10px;
                box-sizing: border-box;
            }

            .achievements-panel {
                width: 85%;
                right: -90%;
                top: 60px;
                max-height: 60vh;
            }

            .achievements-toggle {
                top: 65%;
                font-size: 0.8em;
                padding: 8px 5px;
            }

            .achievement-popup {
                width: 95%;
                padding: 15px;
            }

            .achievement-icon {
                font-size: 2.5em;
            }

            .achievement-title {
                font-size: 1.3em;
            }

            .achievement-description {
                font-size: 0.95em;
            }

            .share-btn, .close-btn {
                font-size: 0.85em;
                padding: 6px 12px;
                margin: 3px;
            }

            .achievement-actions {
                flex-direction: column;
            }

            .achievement-actions button {
                width: 100%;
            }

            .player-input {
                width: 90%;
                font-size: 1em;
            }

            .start-btn, .restart-btn {
                font-size: 1em;
                padding: 12px 30px;
            }
        }

        /* RWD - Ë∂ÖÂ∞èËû¢Âπï */
        @media (max-width: 360px) {
            .title {
                font-size: 1.3em;
            }

            .scene-title {
                font-size: 1em;
            }

            .scene-description {
                font-size: 0.9em;
            }

            .choice {
                font-size: 0.85em;
                padding: 8px;
            }
        }

        /* Êç≤Ëª∏Ê®£Âºè */
        .achievements-panel::-webkit-scrollbar {
            width: 8px;
        }

        .achievements-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .achievements-panel::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 4px;
        }

        .achievements-panel::-webkit-scrollbar-thumb:hover {
            background: #a78bfa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üéÉ Tsext Adventure: Halloween Haunt üéÉ</h1>
            <p class="subtitle">Ëê¨ËÅñÁØÄÁëüÁëüÂÜíÈö™ÈÅäÊà≤</p>
        </div>

        <div class="warning">
            ‚ö†Ô∏è <strong>NSFW Ë≠¶Âëä</strong>ÔºöÊú¨ÈÅäÊà≤ÂåÖÂê´Êàê‰∫∫ÊöóÁ§∫ÂíåÂπΩÈªòÔºåÈÅ©Âêà 18 Ê≠≤‰ª•‰∏äÁé©ÂÆ∂
        </div>

        <!-- Áµ±Ë®àÈù¢Êùø -->
        <div class="stats-panel" id="statsPanel" style="display: none;">
            <div class="stats-title">üìä ÈÅäÊà≤Áµ±Ë®à</div>
            <div class="stat-item">
                <span>Á∏ΩÂàÜÊï∏:</span>
                <span id="totalScore">0</span>
            </div>
            <div class="stat-item">
                <span>ÈÅäÁé©Ê¨°Êï∏:</span>
                <span id="playCount">0</span>
            </div>
            <div class="stat-item">
                <span>Ëß£ÈéñÊàêÂ∞±:</span>
                <span id="achievementCount">0</span>
            </div>
            <div class="stat-item">
                <span>Êé¢Á¥¢Â†¥ÊôØ:</span>
                <span id="sceneCount">0</span>
            </div>
        </div>

        <!-- ÊàêÂ∞±ÂàáÊèõÊåâÈàï -->
        <div class="achievements-toggle" id="achievementsToggle" onclick="toggleAchievementsPanel()" style="display: none;">
            üèÜ ÊàêÂ∞±ÂàóË°®
        </div>

        <!-- ÊàêÂ∞±Èù¢Êùø -->
        <div class="achievements-panel" id="achievementsPanel">
            <div class="achievements-header">
                <div class="achievements-title">üèÜ ÊàêÂ∞±ÂàóË°®</div>
                <button class="achievements-close" onclick="toggleAchievementsPanel()">‚úï</button>
            </div>
            <div id="achievementsList"></div>
        </div>

        <div class="game-area" id="gameArea">
            <div class="start-screen" id="startScreen">
                <h2>üëª Ê≠°Ëøé‰æÜÂà∞Ëê¨ËÅñÁØÄÈùàÁï∞Á¥ÑÊúÉË∂¥ÔºÅ</h2>
                <p>Ê∫ñÂÇôÂ•ΩÂèÉÂä†ÊúÄÂà∫ÊøÄÁöÑËê¨ËÅñÁØÄÂÜíÈö™‰∫ÜÂóéÔºü</p>
                <input type="text" class="player-input" id="playerName" placeholder="Ë´ãËº∏ÂÖ•‰Ω†ÁöÑÂêçÂ≠ó" maxlength="20">
                <br>
                <button class="start-btn" onclick="startGame()">ÈñãÂßãÂÜíÈö™ üéÉ</button>
            </div>
        </div>

        <div class="footer">
            <p>üéÉ Happy Halloween! üéÉ</p>
            <p>ÈñãÊ∫êÂ∞àÊ°à | MIT License | <a href="https://github.com/yourusername/tsext-adventure" style="color: #8b5cf6;">GitHub</a></p>
        </div>
    </div>

    <script>
        // ÈÅäÊà≤ÁãÄÊÖã
        let gameState = {
            currentScene: 'start',
            playerName: '',
            score: 0,
            visitedScenes: new Set(),
            unlockedAchievements: new Set(),
            unlockedBadges: new Set(),
            playCount: 0,
            totalScore: 0,
            gameStartTime: null,
            allEndingsUnlocked: new Set(),
            allScenesVisited: new Set(),
            punsTriggered: new Set()
        };

        // ÊàêÂ∞±Ë≥áÊñô
        const achievementsData = {
            "magic_knight": {
                "name": "È≠îÊ≥ïÈ®éÂ£´",
                "description": "ËàáÂ•≥Â∑´ÈÅîÊàêÂÆåÁæéÁµêÂ±Ä",
                "icon": "üßô‚Äç‚ôÄÔ∏è",
                "rarity": "legendary",
                "condition": "ending_rooftop_romance",
                "points": 100
            },
            "moonlight_lover": {
                "name": "ÊúàÂÖâÊàÄ‰∫∫",
                "description": "Âú®ÊúàÂÖâÊπñÂ∫¶ÈÅéÊµ™Êº´Â§úÊôö",
                "icon": "üåô",
                "rarity": "epic",
                "condition": "ending_moonlight_adventure",
                "points": 90
            },
            "ghost_lover": {
                "name": "È¨ºÈ≠ÇÊàÄ‰∫∫",
                "description": "ËàáÈ¨ºÈ≠ÇÈ´îÈ©óÂ•áÁï∞Ë¶™ÂØÜ",
                "icon": "üëª",
                "rarity": "rare",
                "condition": "ending_ghost_intimacy",
                "points": 85
            },
            "pumpkin_master": {
                "name": "ÂçóÁìúÂ§ßÂ∏´",
                "description": "Âú®ÂçóÁìúÁî∞ÁôºÊèÆÂâµÊÑè",
                "icon": "üéÉ",
                "rarity": "rare",
                "condition": "ending_big_pumpkin_fun",
                "points": 75
            },
            "field_lover": {
                "name": "Áî∞ÈáéÊàÄ‰∫∫",
                "description": "ËàáËæ≤Â§´Â•≥ÈÉéÂ∫¶ÈÅéÊøÄÊÉÖÂ§úÊôö",
                "icon": "üåæ",
                "rarity": "epic",
                "condition": "ending_farmer_seduction",
                "points": 95
            },
            "cat_friend": {
                "name": "Ë≤ìÂí™‰πãÂèã",
                "description": "ËàáÈªëË≤ìÂí™Âí™Âª∫Á´ãÂèãË™º",
                "icon": "üê±",
                "rarity": "common",
                "condition": "ending_cat_adventure",
                "points": 60
            },
            "cat_lady_lover": {
                "name": "Ë≤ìÂ•≥ÊàÄ‰∫∫",
                "description": "ËàáË≤ìÂ•≥ËéâËéâÂ∫¶ÈÅéÊµ™Êº´ÊôÇÂÖâ",
                "icon": "üê±‚Äçüë§",
                "rarity": "rare",
                "condition": "ending_cat_lady_romance",
                "points": 80
            },
            "soul_mate": {
                "name": "ÂøÉÈùà‰º¥‰æ∂",
                "description": "ËàáËæ≤Â§´Â•≥ÈÉéÂª∫Á´ãÊÉÖÊÑüÈÄ£Êé•",
                "icon": "üíï",
                "rarity": "rare",
                "condition": "ending_heart_to_heart",
                "points": 85
            },
            "passion_lover": {
                "name": "ÊøÄÊÉÖÊàÄ‰∫∫",
                "description": "È´îÈ©óÁÅ´ÁÜ±ÁöÑÊøÄÊÉÖÂ§úÊôö",
                "icon": "üî•",
                "rarity": "epic",
                "condition": "ending_physical_attraction",
                "points": 90
            },
            "cold_warrior": {
                "name": "ÂÜ∞ÂÜ∑Êà∞Â£´",
                "description": "ÂãáÊï¢Èù¢Â∞çÈ¨ºÈ≠ÇÁöÑÂÜ∞ÂÜ∑Ëß∏Êë∏",
                "icon": "‚ùÑÔ∏è",
                "rarity": "common",
                "condition": "ending_cold_encounter",
                "points": 70
            },
            "floating_fool": {
                "name": "ÊºÇÊµÆÂÇªÁìú",
                "description": "Âõ†ÁÇ∫ÁÑ°Á¶ÆËÄåÊºÇÊµÆÊíûÂ£ûÂêäÁáà",
                "icon": "üí•",
                "rarity": "common",
                "condition": "ending_floating_mischief",
                "points": 30
            },
            "pumpkin_crusher": {
                "name": "ÂçóÁìúÁ≤âÁ¢éËÄÖ",
                "description": "ÊëîÁ¢éÂçóÁìú‰ΩÜÂ≠∏Âà∞ÊïôË®ì",
                "icon": "üéÉüí•",
                "rarity": "common",
                "condition": "ending_pumpkin_lifting",
                "points": 20
            },
            "ghost_chaser": {
                "name": "È¨ºÈ≠ÇËøΩÈÄêËÄÖ",
                "description": "Ë¢´È¨ºÈ≠ÇËøΩÈÄêÊúÄÂæåÁµÜÂÄí",
                "icon": "üèÉ‚Äç‚ôÇÔ∏èüëª",
                "rarity": "common",
                "condition": "ending_ghost_chase",
                "points": 25
            },
            "explorer": {
                "name": "Êé¢Á¥¢ËÄÖ",
                "description": "Êé¢Á¥¢‰∫ÜÊâÄÊúâ‰∏ªË¶ÅÂ†¥ÊôØ",
                "icon": "üó∫Ô∏è",
                "rarity": "rare",
                "condition": "visited_all_scenes",
                "points": 50
            },
            "completionist": {
                "name": "ÂÆåÁæé‰∏ªÁæ©ËÄÖ",
                "description": "Ëß£Èéñ‰∫ÜÊâÄÊúâÁµêÂ±Ä",
                "icon": "üèÜ",
                "rarity": "legendary",
                "condition": "all_endings_unlocked",
                "points": 200
            },
            "speed_demon": {
                "name": "ÈÄüÂ∫¶ÊÉ°È≠î",
                "description": "Âú® 5 ÂàÜÈêòÂÖßÂÆåÊàêÈÅäÊà≤",
                "icon": "‚ö°",
                "rarity": "rare",
                "condition": "speed_run_5min",
                "points": 75
            },
            "pun_master": {
                "name": "ÈõôÈóúË™ûÂ§ßÂ∏´",
                "description": "Ëß∏Áôº‰∫ÜÊâÄÊúâËê¨ËÅñÁØÄÈõôÈóúË™û",
                "icon": "üòÑ",
                "rarity": "epic",
                "condition": "all_puns_triggered",
                "points": 100
            },
            "romance_expert": {
                "name": "Êµ™Êº´Â∞àÂÆ∂",
                "description": "ÈÅîÊàêÊâÄÊúâÊµ™Êº´ÁµêÂ±Ä",
                "icon": "üíò",
                "rarity": "rare",
                "condition": "all_romance_endings",
                "points": 80
            },
            "adventure_seeker": {
                "name": "ÂÜíÈö™Â∞ãÊ±ÇËÄÖ",
                "description": "ÂòóË©¶‰∫ÜÊâÄÊúâÂÜíÈö™ÈÅ∏Êìá",
                "icon": "üó°Ô∏è",
                "rarity": "rare",
                "condition": "all_adventure_choices",
                "points": 70
            },
            "halloween_legend": {
                "name": "Ëê¨ËÅñÁØÄÂÇ≥Â•á",
                "description": "Áç≤Âæó 1000 ÂàÜ‰ª•‰∏ä",
                "icon": "üéÉüëë",
                "rarity": "legendary",
                "condition": "score_1000_plus",
                "points": 300
            }
        };

        // ÂæΩÁ´†Ë≥áÊñô
        const badgesData = {
            "first_play": {
                "name": "Âàù‰æÜ‰πçÂà∞",
                "description": "Á¨¨‰∏ÄÊ¨°ÈÅäÁé©",
                "icon": "üë∂",
                "rarity": "common"
            },
            "night_owl": {
                "name": "Â§úË≤ìÂ≠ê",
                "description": "Âú®Ê∑±Â§úÊôÇÂàÜÈÅäÁé©",
                "icon": "ü¶â",
                "rarity": "common"
            },
            "early_bird": {
                "name": "Êó©Ëµ∑È≥•",
                "description": "Âú®Ê∏ÖÊô®ÊôÇÂàÜÈÅäÁé©",
                "icon": "üê¶",
                "rarity": "common"
            },
            "weekend_warrior": {
                "name": "ÈÄ±Êú´Êà∞Â£´",
                "description": "Âú®ÈÄ±Êú´ÈÅäÁé©",
                "icon": "‚öîÔ∏è",
                "rarity": "common"
            },
            "repeat_player": {
                "name": "ÈáçË§áÁé©ÂÆ∂",
                "description": "ÈÅäÁé©Ë∂ÖÈÅé 5 Ê¨°",
                "icon": "üîÑ",
                "rarity": "rare"
            },
            "social_butterfly": {
                "name": "Á§æ‰∫§Ëù¥Ëù∂",
                "description": "ÂàÜ‰∫´‰∫Ü 3 Ê¨°ÊàêÂ∞±",
                "icon": "ü¶ã",
                "rarity": "rare"
            },
            "perfectionist": {
                "name": "ÂÆåÁæé‰∏ªÁæ©ËÄÖ",
                "description": "ÂñÆÊ¨°ÈÅäÊà≤Áç≤ÂæóÊªøÂàÜ",
                "icon": "üíØ",
                "rarity": "epic"
            },
            "lucky_charm": {
                "name": "Âπ∏ÈÅãÁ¨¶",
                "description": "ÈÄ£Á∫å 3 Ê¨°Áç≤ÂæóÁ®ÄÊúâÊàêÂ∞±",
                "icon": "üçÄ",
                "rarity": "epic"
            },
            "halloween_spirit": {
                "name": "Ëê¨ËÅñÁØÄÁ≤æÁ•û",
                "description": "Âú®Ëê¨ËÅñÁØÄÊúüÈñìÈÅäÁé©",
                "icon": "üéÉ",
                "rarity": "rare"
            },
            "midnight_magic": {
                "name": "ÂçàÂ§úÈ≠îÊ≥ï",
                "description": "Âú®ÂçàÂ§úÊôÇÂàÜÂÆåÊàêÈÅäÊà≤",
                "icon": "üïõ",
                "rarity": "rare"
            }
        };

        // Á§æ‰∫§Âπ≥Âè∞Ë≥áÊñô
        const socialPlatforms = {
            "twitter": {
                "name": "Twitter",
                "icon": "üê¶",
                "url": "https://twitter.com/intent/tweet",
                "hashtags": ["TsextAdventure", "HalloweenHaunt", "NSFWGame"]
            },
            "facebook": {
                "name": "Facebook",
                "icon": "üìò",
                "url": "https://www.facebook.com/sharer/sharer.php",
                "hashtags": ["TsextAdventure", "HalloweenHaunt"]
            },
            "instagram": {
                "name": "Instagram",
                "icon": "üì∑",
                "url": "https://www.instagram.com/",
                "hashtags": ["#TsextAdventure", "#HalloweenHaunt", "#NSFWGame"]
            },
            "threads": {
                "name": "Threads",
                "icon": "üßµ",
                "url": "https://www.threads.net/intent/post",
                "hashtags": ["#TsextAdventure", "#HalloweenHaunt"]
            },
            "line": {
                "name": "LINE",
                "icon": "üí¨",
                "url": "https://social-plugins.line.me/lineit/share",
                "hashtags": ["TsextAdventure", "HalloweenHaunt"]
            },
            "discord": {
                "name": "Discord",
                "icon": "üí¨",
                "url": "https://discord.com/",
                "hashtags": ["TsextAdventure", "HalloweenHaunt"]
            },
            "reddit": {
                "name": "Reddit",
                "icon": "ü§ñ",
                "url": "https://reddit.com/submit",
                "hashtags": ["TsextAdventure", "HalloweenHaunt", "NSFWGame"]
            },
            "telegram": {
                "name": "Telegram",
                "icon": "‚úàÔ∏è",
                "url": "https://t.me/share/url",
                "hashtags": ["TsextAdventure", "HalloweenHaunt"]
            }
        };

        // ÊïÖ‰∫ãË≥áÊñô
        const storyData = {
            "start": {
                "title": "Ëê¨ËÅñÁØÄÈùàÁï∞Á¥ÑÊúÉË∂¥ÂÖ•Âè£",
                "description": "‰Ω†Á´ôÂú®‰∏ÄÊ£üÈô∞Ê£ÆÁöÑËÄÅÂÆÖÂâçÔºåÈñÄÂè£ÊéõËëó„ÄåÊ≠°ËøéÂèÉÂä†Ëê¨ËÅñÁØÄÈùàÁï∞Á¥ÑÊúÉË∂¥„ÄçÁöÑÁâåÂ≠ê„ÄÇÊúàÂÖâÈÄèÈÅéÁÉèÈõ≤ÁÅë‰∏ãÔºåÂçóÁìúÁáàÂú®È¢®‰∏≠ÊêñÊõ≥ÔºåÁôºÂá∫Ë©≠Áï∞ÁöÑÂÖâËäí„ÄÇ\n\n‰Ω†ËÅΩÂà∞Â±ãÂÖßÂÇ≥‰æÜÁ¨ëËÅ≤„ÄÅÈü≥Ê®ÇËÅ≤ÔºåÈÇÑÊúâ‰∏Ä‰∫õ... Â•áÊÄ™ÁöÑËÅ≤Èü≥„ÄÇÈñÄÂè£Á´ôËëó‰∏ÄÂÄãÁ©øËëóÊÄßÊÑüÂ•≥Â∑´Ë£ùÁöÑÊé•ÂæÖÂì°ÔºåÂ•πÂ∞ç‰Ω†Áú®‰∫ÜÁú®Áúº„ÄÇ",
                "choices": [
                    {"option": "A: Â∞çÂ•≥Â∑´Ë™™„Äå‰Ω†ÁöÑÊéÉÂ∏öÁúüÊºÇ‰∫ÆÔºåËÉΩÈ®éÂóéÔºü„Äç", "next_scene": "witch_encounter"},
                    {"option": "B: Áõ¥Êé•ÈÄ≤ÂÖ•È¨ºÂ±ãÊé¢Èö™", "next_scene": "haunted_house"},
                    {"option": "C: ÂÖàÂéªÂçóÁìúÁî∞ÁúãÁúã", "next_scene": "pumpkin_patch"}
                ]
            },
            "witch_encounter": {
                "title": "Â•≥Â∑´ÁöÑË™òÊÉë",
                "description": "Â•≥Â∑´ÂíØÂíØÁ¨ëËëóË™™Ôºö„ÄåÁï∂ÁÑ∂ÂèØ‰ª•È®éÔºå‰ΩÜ‰Ω†Ë¶ÅÂ∞èÂøÉ‰∏çË¶ÅË¢´ÊéÉÂ∏öÊüÑ... ‰Ω†Áü•ÈÅìÁöÑ„ÄÇ„ÄçÂ•πÊèÆ‰∫ÜÊèÆÊâãÔºåÊéÉÂ∏öÁ™ÅÁÑ∂È£õÂà∞‰Ω†Èù¢Ââç„ÄÇ\n\n„Äå‰∏çÈÅéÔºå„ÄçÂ•πÁ•ûÁßòÂú∞Á¨ëËëóÔºå„ÄåÊàëÁöÑÊéÉÂ∏öÂæàÊåëÂâîÔºåÂè™ÊúâÁúüÊ≠£ÂãáÊï¢ÁöÑ‰∫∫ÊâçËÉΩÈßïÈ¶≠ÂÆÉ„ÄÇ„Äç",
                "choices": [
                    {"option": "A: ÂãáÊï¢Âú∞Ë∑®‰∏äÊéÉÂ∏ö", "next_scene": "broom_ride_success"},
                    {"option": "B: Ë™™„ÄåÊàëÊõ¥ÊÉ≥È®é‰Ω†„Äç", "next_scene": "witch_rejection"},
                    {"option": "C: Âïè„Äå‰Ω†ÁöÑË≤ìÂí™Âú®Âì™Ë£°Ôºü„Äç", "next_scene": "cat_encounter"}
                ]
            },
            "broom_ride_success": {
                "title": "ÊéÉÂ∏öÈ£õË°åÊàêÂäü",
                "description": "‰Ω†ÊàêÂäüË∑®‰∏äÊéÉÂ∏öÔºåÂÆÉËºâËëó‰Ω†Âú®ÊúàÂÖâ‰∏ãÈ£õÁøîÔºÅÂ•≥Â∑´Âú®‰∏ãÈù¢ÈºìÊéåÔºö„ÄåÂ§™Ê£í‰∫ÜÔºÅ‰Ω†ÊòØÊàëË¶ãÈÅéÊúÄÂãáÊï¢ÁöÑÈ®éÂ£´ÔºÅ„Äç\n\n‰Ω†ÂÄë‰∏ÄËµ∑È£õÂà∞Â±ãÈ†ÇÔºåÁúãËëó‰∏ãÈù¢ÁöÑÊ¥æÂ∞ç„ÄÇÂ•≥Â∑´Èù†Ëøë‰Ω†ÔºåËºïËÅ≤Ë™™Ôºö„ÄåÁèæÂú®... ËÆìÊàëÂÄëÂÅö‰∏Ä‰∫õÊõ¥Âà∫ÊøÄÁöÑ‰∫ãÊÉÖ„ÄÇ„Äç",
                "choices": [
                    {"option": "A: Âú®Â±ãÈ†Ç‰∏äË¶™ÂêªÂ•≥Â∑´", "next_scene": "rooftop_romance"},
                    {"option": "B: ÊèêË≠∞‰∏ÄËµ∑È£õÂà∞Êõ¥ÈÅ†ÁöÑÂú∞Êñπ", "next_scene": "moonlight_adventure"}
                ]
            },
            "rooftop_romance": {
                "title": "Â±ãÈ†ÇÊµ™Êº´",
                "description": "Âú®ÊúàÂÖâ‰∏ãÔºå‰Ω†ÂíåÂ•≥Â∑´Âú®Â±ãÈ†Ç‰∏äÊìÅÂêª„ÄÇÂ•πÁöÑÂò¥ÂîáÊ∫´ÊöñËÄåÁîúËúúÔºåÂ∏∂ËëóÈ≠îÊ≥ïÁöÑÂë≥ÈÅì„ÄÇÁ™ÅÁÑ∂ÔºåÂ•πÊé®Èñã‰Ω†ÔºåÁ¨ëËëóË™™Ôºö„ÄåÁèæÂú®ËÆìÊàëÂÄëÂÅö‰∏Ä‰∫õÁúüÊ≠£ÁöÑÈ≠îÊ≥ïÔºÅ„Äç\n\nÂ•πÊèÆÂãïÈ≠îÊùñÔºå‰Ω†ÂÄëÂë®ÂúçÂá∫Áèæ‰∫ÜÈñÉÁàçÁöÑÊòüÊòüÔºåÊï¥ÂÄã‰∏ñÁïåÈÉΩËÆäÂæóÊµ™Êº´Ëµ∑‰æÜ„ÄÇ",
                "is_ending": true,
                "outcome": "üéâ ÂÆåÁæéÁµêÂ±ÄÔºÅ‰Ω†ÂíåÂ•≥Â∑´Âú®È≠îÊ≥ïÊòüÂÖâ‰∏ãÂ∫¶ÈÅé‰∫ÜÈõ£ÂøòÁöÑËê¨ËÅñÁØÄÂ§úÊôöÔºÅ\n\n‰Ω†Áç≤Âæó‰∫Ü„ÄéÈ≠îÊ≥ïÈ®éÂ£´„ÄèÁöÑÁ®±ËôüÔºå‰∏¶‰∏îÂ≠∏ÊúÉ‰∫ÜÁúüÊ≠£ÁöÑÊÑõÊÉÖÈ≠îÊ≥ï„ÄÇ",
                "score": 100
            },
            "moonlight_adventure": {
                "title": "ÊúàÂÖâÂÜíÈö™",
                "description": "‰Ω†ÂÄëÈ£õÂà∞Êõ¥ÈÅ†ÁöÑÂú∞ÊñπÔºå‰æÜÂà∞‰∏ÄÂÄãÈö±ÁßòÁöÑÊúàÂÖâÊπñ„ÄÇÂ•≥Â∑´Ë™™Ôºö„ÄåÈÄôË£°ÊòØÊàëÁöÑÁßòÂØÜËä±ÂúíÔºåÂè™ÊúâÁúüÊ≠£ÁâπÂà•ÁöÑ‰∫∫ÊâçËÉΩ‰æÜÂà∞ÈÄôË£°„ÄÇ„Äç\n\nÂú®ÊúàÂÖâ‰∏ãÔºå‰Ω†ÂÄë‰∏ÄËµ∑Êé¢Á¥¢ËëóÂΩºÊ≠§ÁöÑÂÖßÂøÉÔºåÂ∫¶ÈÅé‰∫ÜÊúÄÊµ™Êº´ÁöÑÂ§úÊôö„ÄÇ",
                "is_ending": true,
                "outcome": "üåô Êµ™Êº´ÁµêÂ±ÄÔºÅ‰Ω†ÂíåÂ•≥Â∑´Âú®ÊúàÂÖâÊπñÂ∫¶ÈÅé‰∫ÜÊúÄÁæéÂ•ΩÁöÑÊôÇÂÖâÔºÅ\n\n‰Ω†Áç≤Âæó‰∫Ü„ÄéÊúàÂÖâÊàÄ‰∫∫„ÄèÁöÑÁ®±ËôüÔºå‰∏¶‰∏îÊ∞∏ÈÅ†Ë®ò‰Ωè‰∫ÜÈÄôÂÄãÁ•ûÂ•áÁöÑÂ§úÊôö„ÄÇ",
                "score": 90
            },
            "witch_rejection": {
                "title": "Â•≥Â∑´ÁöÑÊãíÁµï",
                "description": "Â•≥Â∑´Áö∫Ëµ∑ÁúâÈ†≠Ôºö„Äå‰Ω†‰ª•ÁÇ∫ÊàëÊòØ‰ªÄÈ∫ºÔºüÈö®‰æøÁöÑÂ•≥Â∑´ÂóéÔºü„ÄçÂ•πÊèÆÂãïÈ≠îÊùñÔºå‰Ω†Á™ÅÁÑ∂ÊÑüË¶∫Ë∫´È´îËÆäËºï‰∫Ü...\n\n„ÄåÊó¢ÁÑ∂‰Ω†ÈÄôÈ∫ºÁÑ°Á¶ÆÔºåÂ∞±ËÆì‰Ω†È´îÈ©ó‰∏Ä‰∏ãÁúüÊ≠£ÁöÑ„ÄéËºïÂ¶ÇÁæΩÊØõ„ÄèÂêßÔºÅ„Äç‰Ω†ÈñãÂßãÈ£ÑÊµÆÂú®Á©∫‰∏≠ÔºåÁÑ°Ê≥ïÊéßÂà∂ÊñπÂêë„ÄÇ",
                "choices": [
                    {"option": "A: ÈÅìÊ≠â‰∏¶Ë´ãÊ±ÇÂéüË´í", "next_scene": "apology_accepted"},
                    {"option": "B: Ë©¶ÂúñÊäì‰Ωè‰ªÄÈ∫ºÊù±Ë•ø", "next_scene": "floating_mischief"}
                ]
            },
            "floating_mischief": {
                "title": "ÊºÇÊµÆÊÉ°‰ΩúÂäá",
                "description": "‰Ω†Ë©¶ÂúñÊäì‰Ωè‰ªÄÈ∫ºÊù±Ë•øÔºå‰ΩÜÂè™ËÉΩÂú®Á©∫‰∏≠È£ÑÊµÆ„ÄÇÂ•≥Â∑´Âú®‰∏ãÈù¢Á¨ëËëóÔºö„ÄåÈÄôÂ∞±ÊòØÁÑ°Á¶ÆÁöÑ‰ª£ÂÉπÔºÅ„Äç\n\nÁ™ÅÁÑ∂Ôºå‰Ω†ÊíûÂà∞‰∫Ü‰∏ÄÂÄãÂêäÁáàÔºåÁáàÊ≥°ÁàÜË£ÇÔºåÁÅ´Ëä±ÂõõÊø∫„ÄÇÂ•≥Â∑´È©öÂè´Ôºö„ÄåÊàëÁöÑÂ§©ÔºÅÂø´‰∏ã‰æÜÔºÅ„ÄçÂ•πÊèÆÂãïÈ≠îÊùñÔºå‰Ω†ÂÆâÂÖ®Âú∞ÈôçËêΩÂà∞Âú∞Èù¢„ÄÇ",
                "is_ending": true,
                "outcome": "üí• ÊêûÁ¨ëÁµêÂ±ÄÔºÅ‰Ω†Âõ†ÁÇ∫ÁÑ°Á¶ÆËÄåÊºÇÊµÆÔºåÊúÄÂæåÊíûÂ£û‰∫ÜÂêäÁáàÔºÅ\n\nÈõñÁÑ∂ÁµêÂ±ÄÊúâÈªûÂ∞∑Â∞¨Ôºå‰ΩÜËá≥Â∞ë‰Ω†Â≠∏ÊúÉ‰∫ÜÂ∞çÂ•≥Â∑´Ë¶ÅÊúâÁ¶ÆË≤å„ÄÇ",
                "score": 30
            },
            "haunted_house": {
                "title": "È¨ºÂ±ãÂÖßÈÉ®",
                "description": "‰Ω†Ëµ∞ÈÄ≤È¨ºÂ±ãÔºåË£°Èù¢ÁáàÂÖâÊòèÊöóÔºåÁâÜ‰∏äÊéõËëóÂè§ËÄÅÁöÑÁï´ÂÉè„ÄÇÁ™ÅÁÑ∂Ôºå‰∏ÄÂÄãÂçäÈÄèÊòéÁöÑÈ¨ºÈ≠ÇÂæûÁâÜÂ£Å‰∏≠È£ÑÂá∫‰æÜÔºÅ\n\n„ÄåÊ≠°Ëøé‰æÜÂà∞ÊàëÁöÑÂÆ∂Ôºå„ÄçÈ¨ºÈ≠ÇË™™Ôºå„ÄåÊàëÊòØÈÄôË£°ÁöÑ‰∏ª‰∫∫ÔºåÂ∑≤Á∂ìÊ≠ª‰∫Ü 200 Âπ¥‰∫Ü„ÄÇ‰ΩÜÊàëÈÇÑÊòØÂæà... Ê¥ªË∫ç„ÄÇ„Äç‰ªñÂ∞ç‰Ω†Áú®‰∫ÜÁú®Áúº„ÄÇ",
                "choices": [
                    {"option": "A: Ë™™„Äå‰Ω†ÁúãËµ∑‰æÜÂæàÂØÇÂØû„Äç", "next_scene": "ghost_romance"},
                    {"option": "B: Âïè„Äå‰Ω†ËÉΩËß∏Êë∏ÂØ¶È´îÂóéÔºü„Äç", "next_scene": "ghost_touch"},
                    {"option": "C: Ë©¶ÂúñÈÄÉË∑ë", "next_scene": "ghost_chase"}
                ]
            },
            "ghost_romance": {
                "title": "È¨ºÈ≠ÇÁöÑÊµ™Êº´",
                "description": "È¨ºÈ≠ÇÂòÜ‰∫ÜÂè£Ê∞£Ôºö„ÄåÊòØÁöÑÔºåÊàëÁ¢∫ÂØ¶ÂæàÂØÇÂØû„ÄÇ200 Âπ¥‰æÜÔºåÊ≤íÊúâ‰∫∫È°òÊÑèÂíåÊàë... ‰Ω†Áü•ÈÅìÁöÑ„ÄÇ„Äç‰ªñÁöÑËÅ≤Èü≥Â∏∂ËëóÊ∏¥Êúõ„ÄÇ\n\n„Äå‰ΩÜÊòØÔºå„Äç‰ªñÁ™ÅÁÑ∂ËààÂ•ÆÂú∞Ë™™Ôºå„ÄåÂ¶ÇÊûú‰Ω†È°òÊÑèÔºåÊàëÂèØ‰ª•Êïô‰Ω†‰∏Ä‰∫õÈ¨ºÈ≠ÇÁöÑ... ÁâπÊÆäÊäÄÂ∑ß„ÄÇ„Äç",
                "choices": [
                    {"option": "A: Ë™™„ÄåÊàëÂæàÊÑüËààË∂£„Äç", "next_scene": "ghost_lessons"},
                    {"option": "B: Âïè„ÄåÊúÉ‰∏çÊúÉÂæàÂÜ∑Ôºü„Äç", "next_scene": "cold_encounter"}
                ]
            },
            "cold_encounter": {
                "title": "ÂÜ∞ÂÜ∑ÁöÑÁõ∏ÈÅá",
                "description": "È¨ºÈ≠ÇÁ¨ëËëóË™™Ôºö„Äå‰∏ÄÈñãÂßãÊúÉÊúâÈªûÂÜ∑Ôºå‰ΩÜÂæàÂø´Â∞±ÊúÉËÆäÊöñÁöÑ„ÄÇËÆìÊàëÁ§∫ÁØÑÁµ¶‰Ω†Áúã...„Äç\n\n‰ªñËºïËºïËß∏Êë∏‰Ω†ÁöÑÊâãÔºå‰Ω†ÊÑüË¶∫Âà∞‰∏ÄÈô£Ê∂ºÊÑèÔºå‰ΩÜÂêåÊôÇÂèàÊúâ‰∏ÄÁ®ÆÂ•áÁï∞ÁöÑÊ∫´Êöñ„ÄÇ‰ªñÁöÑËß∏Êë∏ËÆì‰Ω†ÊÑüÂà∞Êó¢Âà∫ÊøÄÂèàËàíÈÅ©„ÄÇ",
                "is_ending": true,
                "outcome": "‚ùÑÔ∏è ÂÜ∞ÂÜ∑ÁµêÂ±ÄÔºÅ‰Ω†ÂíåÈ¨ºÈ≠ÇÂ∫¶ÈÅé‰∫ÜÂ•áÁï∞ÁöÑÂ§úÊôöÔºÅ\n\nÈõñÁÑ∂ÊúâÈªûÂÜ∑Ôºå‰ΩÜ‰Ω†È´îÈ©óÂà∞‰∫ÜÂâçÊâÄÊú™ÊúâÁöÑÊÑüË¶∫„ÄÇ",
                "score": 70
            },
            "pumpkin_patch": {
                "title": "ÂçóÁìúÁî∞ÁöÑË™òÊÉë",
                "description": "‰Ω†‰æÜÂà∞ÂçóÁìúÁî∞ÔºåÊúàÂÖâ‰∏ãÁöÑÂ§ßÂçóÁìúÁúãËµ∑‰æÜÊ†ºÂ§ñË™ò‰∫∫„ÄÇÁ™ÅÁÑ∂Ôºå‰∏ÄÂÄãÁ©øËëóËæ≤Â§´Ë£ùÁöÑÊÄßÊÑüÂ•≥ÈÉéÂæûÂçóÁìúÂæåÈù¢Ëµ∞Âá∫‰æÜ„ÄÇ\n\n„ÄåÊ≠°Ëøé‰æÜÂà∞ÊàëÁöÑÂçóÁìúÁî∞Ôºå„ÄçÂ•πË™™Ôºå„ÄåÊàëÊòØÈÄôË£°ÁöÑÂÆàË≠∑ËÄÖ„ÄÇÈÄô‰∫õÂçóÁìúÈÉΩÂæàÁâπÂà•... ÂÆÉÂÄëÊúÉÂõûÊáâ‰Ω†ÁöÑÊÖæÊúõ„ÄÇ„Äç",
                "choices": [
                    {"option": "A: Âïè„ÄåÂçóÁìúÊúÉÂõûÊáâ‰ªÄÈ∫ºÊÖæÊúõÔºü„Äç", "next_scene": "pumpkin_magic"},
                    {"option": "B: Ë™™„ÄåÊàëÊõ¥ÊÉ≥‰∫ÜËß£‰Ω†„Äç", "next_scene": "farmer_romance"}
                ]
            },
            "farmer_romance": {
                "title": "Ëæ≤Â§´ÁöÑÊµ™Êº´",
                "description": "Ëæ≤Â§´Â•≥ÈÉéÂ∞ç‰Ω†ÁöÑÁõ¥Êé•ÊÑüÂà∞È©öË®ùÔºåÁÑ∂ÂæåÁ¨ë‰∫Ü„ÄÇ„Äå‰Ω†ÂæàÊúâË∂£Ôºå„ÄçÂ•πË™™Ôºå„ÄåÊàëÂñúÊ≠°Áõ¥Êé•ÁöÑ‰∫∫„ÄÇ„Äç\n\nÂ•πÈù†Ëøë‰Ω†ÔºåËºïËÅ≤Ë™™Ôºö„ÄåÈÇ£È∫ºÔºå‰Ω†ÊÉ≥Ë¶Å‰∫ÜËß£ÊàëÁöÑÂì™ÂÄãÊñπÈù¢Âë¢Ôºü„ÄçÂ•πÁöÑÁúºÁùõÈñÉÁàçËëóË™òÊÉëÁöÑÂÖâËäí„ÄÇ",
                "choices": [
                    {"option": "A: Ë™™„ÄåÊàëÊÉ≥‰∫ÜËß£‰Ω†ÁöÑÂøÉ„Äç", "next_scene": "heart_to_heart"},
                    {"option": "B: Ë™™„ÄåÊàëÊÉ≥‰∫ÜËß£‰Ω†ÁöÑË∫´È´î„Äç", "next_scene": "physical_attraction"}
                ]
            },
            "heart_to_heart": {
                "title": "ÂøÉÈùà‰∫§ÊµÅ",
                "description": "Ëæ≤Â§´Â•≥ÈÉéÂ∞ç‰Ω†ÁöÑÂõûÁ≠îÊÑüÂà∞ÊÑüÂãï„ÄÇ„Äå‰Ω†ÊòØ‰∏ÄÂÄãÁúüÊ≠£ÁöÑ‰∫∫Ôºå„ÄçÂ•πË™™Ôºå„ÄåÊàëÈ°òÊÑèÂíå‰Ω†ÂàÜ‰∫´ÊàëÁöÑÂÖßÂøÉ„ÄÇ„Äç\n\n‰Ω†ÂÄëÂùêÂú®ÂçóÁìúÁî∞ÈÇäÔºåÂàÜ‰∫´ËëóÂΩºÊ≠§ÁöÑÊïÖ‰∫ãÂíåÂ§¢ÊÉ≥ÔºåÂ∫¶ÈÅé‰∫ÜÊúÄÁæéÂ•ΩÁöÑÊôÇÂÖâ„ÄÇ",
                "is_ending": true,
                "outcome": "üíï ÂøÉÈùàÁµêÂ±ÄÔºÅ‰Ω†ÂíåËæ≤Â§´Â•≥ÈÉéÂª∫Á´ã‰∫ÜÊ∑±ÂéöÁöÑÊÉÖÊÑüÈÄ£Êé•ÔºÅ\n\n‰Ω†Áç≤Âæó‰∫Ü„ÄéÂøÉÈùà‰º¥‰æ∂„ÄèÁöÑÁ®±ËôüÔºå‰∏¶‰∏îÊ∞∏ÈÅ†Ë®ò‰Ωè‰∫ÜÈÄôÂÄãÁæéÂ•ΩÁöÑÂ§úÊôö„ÄÇ",
                "score": 85
            },
            "physical_attraction": {
                "title": "Ë∫´È´îÂê∏Âºï",
                "description": "Ëæ≤Â§´Â•≥ÈÉéÂ∞ç‰Ω†ÁöÑÁõ¥Êé•ÊÑüÂà∞ËààÂ•Æ„ÄÇ„ÄåÂæàÂ•ΩÔºå„ÄçÂ•πË™™Ôºå„ÄåÊàëÂñúÊ≠°Ë™†ÂØ¶ÁöÑ‰∫∫„ÄÇ„Äç\n\nÂ•πÊãâËëó‰Ω†ÁöÑÊâãÔºåÂ∏∂‰Ω†Âà∞ÂçóÁìúÁî∞ÁöÑÊ∑±Ëôï„ÄÇ„ÄåËÆìÊàëÂÄëÂÅö‰∏Ä‰∫õÁúüÊ≠£ÊúâË∂£ÁöÑ‰∫ãÊÉÖÔºå„ÄçÂ•πËºïËÅ≤Ë™™„ÄÇ",
                "is_ending": true,
                "outcome": "üî• ÊøÄÊÉÖÁµêÂ±ÄÔºÅ‰Ω†ÂíåËæ≤Â§´Â•≥ÈÉéÂ∫¶ÈÅé‰∫ÜÁÅ´ÁÜ±ÁöÑÂ§úÊôöÔºÅ\n\n‰Ω†Áç≤Âæó‰∫Ü„ÄéÊøÄÊÉÖÊàÄ‰∫∫„ÄèÁöÑÁ®±ËôüÔºå‰∏¶‰∏îÊ∞∏ÈÅ†Ë®ò‰Ωè‰∫ÜÈÄôÂÄãÂÖÖÊªøÊøÄÊÉÖÁöÑÂ§úÊôö„ÄÇ",
                "score": 90
            }
        };

        // ËºâÂÖ•ÈÅäÊà≤Ë≥áÊñô
        function loadGameData() {
            const saved = localStorage.getItem('tsextAdventureData');
            if (saved) {
                const data = JSON.parse(saved);
                gameState.unlockedAchievements = new Set(data.unlockedAchievements || []);
                gameState.unlockedBadges = new Set(data.unlockedBadges || []);
                gameState.playCount = data.playCount || 0;
                gameState.totalScore = data.totalScore || 0;
                gameState.allEndingsUnlocked = new Set(data.allEndingsUnlocked || []);
                gameState.allScenesVisited = new Set(data.allScenesVisited || []);
                gameState.punsTriggered = new Set(data.punsTriggered || []);
            }
        }

        // ÂÑ≤Â≠òÈÅäÊà≤Ë≥áÊñô
        function saveGameData() {
            const data = {
                unlockedAchievements: Array.from(gameState.unlockedAchievements),
                unlockedBadges: Array.from(gameState.unlockedBadges),
                playCount: gameState.playCount,
                totalScore: gameState.totalScore,
                allEndingsUnlocked: Array.from(gameState.allEndingsUnlocked),
                allScenesVisited: Array.from(gameState.allScenesVisited),
                punsTriggered: Array.from(gameState.punsTriggered)
            };
            localStorage.setItem('tsextAdventureData', JSON.stringify(data));
        }

        // Ê™¢Êü•ÊàêÂ∞±
        function checkAchievements(sceneId) {
            const newAchievements = [];
            
            // Ê™¢Êü•ÁµêÂ±ÄÊàêÂ∞±
            if (storyData[sceneId] && storyData[sceneId].is_ending) {
                const endingCondition = `ending_${sceneId}`;
                for (const [achievementId, achievement] of Object.entries(achievementsData)) {
                    if (achievement.condition === endingCondition && !gameState.unlockedAchievements.has(achievementId)) {
                        gameState.unlockedAchievements.add(achievementId);
                        newAchievements.push(achievementId);
                    }
                }
            }

            // Ê™¢Êü•ÁâπÊÆäÊàêÂ∞±
            checkSpecialAchievements();

            // È°ØÁ§∫Êñ∞ÊàêÂ∞±
            newAchievements.forEach(achievementId => {
                showAchievementPopup(achievementId);
            });

            // Êõ¥Êñ∞ÊàêÂ∞±Èù¢Êùø
            updateAchievementsPanel();
            updateStatsPanel();
            saveGameData();
        }

        // Ê™¢Êü•ÁâπÊÆäÊàêÂ∞±
        function checkSpecialAchievements() {
            // Êé¢Á¥¢ËÄÖÊàêÂ∞±
            if (gameState.visitedScenes.size >= 10 && !gameState.unlockedAchievements.has('explorer')) {
                gameState.unlockedAchievements.add('explorer');
                showAchievementPopup('explorer');
            }

            // ÂÆåÁæé‰∏ªÁæ©ËÄÖÊàêÂ∞±
            if (gameState.allEndingsUnlocked.size >= 8 && !gameState.unlockedAchievements.has('completionist')) {
                gameState.unlockedAchievements.add('completionist');
                showAchievementPopup('completionist');
            }

            // ÈÄüÂ∫¶ÊÉ°È≠îÊàêÂ∞±
            if (gameState.gameStartTime) {
                const playTime = (Date.now() - gameState.gameStartTime) / 1000 / 60; // ÂàÜÈêò
                if (playTime <= 5 && !gameState.unlockedAchievements.has('speed_demon')) {
                    gameState.unlockedAchievements.add('speed_demon');
                    showAchievementPopup('speed_demon');
                }
            }

            // Ëê¨ËÅñÁØÄÂÇ≥Â•áÊàêÂ∞±
            if (gameState.totalScore >= 1000 && !gameState.unlockedAchievements.has('halloween_legend')) {
                gameState.unlockedAchievements.add('halloween_legend');
                showAchievementPopup('halloween_legend');
            }
        }

        // Ê™¢Êü•ÂæΩÁ´†
        function checkBadges() {
            const newBadges = [];
            const now = new Date();
            const hour = now.getHours();
            const day = now.getDay();

            // Á¨¨‰∏ÄÊ¨°ÈÅäÁé©
            if (gameState.playCount === 1 && !gameState.unlockedBadges.has('first_play')) {
                gameState.unlockedBadges.add('first_play');
                newBadges.push('first_play');
            }

            // Â§úË≤ìÂ≠ê
            if ((hour >= 22 || hour <= 2) && !gameState.unlockedBadges.has('night_owl')) {
                gameState.unlockedBadges.add('night_owl');
                newBadges.push('night_owl');
            }

            // Êó©Ëµ∑È≥•
            if (hour >= 5 && hour <= 8 && !gameState.unlockedBadges.has('early_bird')) {
                gameState.unlockedBadges.add('early_bird');
                newBadges.push('early_bird');
            }

            // ÈÄ±Êú´Êà∞Â£´
            if ((day === 0 || day === 6) && !gameState.unlockedBadges.has('weekend_warrior')) {
                gameState.unlockedBadges.add('weekend_warrior');
                newBadges.push('weekend_warrior');
            }

            // ÈáçË§áÁé©ÂÆ∂
            if (gameState.playCount >= 5 && !gameState.unlockedBadges.has('repeat_player')) {
                gameState.unlockedBadges.add('repeat_player');
                newBadges.push('repeat_player');
            }

            // ÂçàÂ§úÈ≠îÊ≥ï
            if (hour === 0 && !gameState.unlockedBadges.has('midnight_magic')) {
                gameState.unlockedBadges.add('midnight_magic');
                newBadges.push('midnight_magic');
            }

            return newBadges;
        }

        // È°ØÁ§∫ÊàêÂ∞±ÂΩàÁ™ó
        function showAchievementPopup(achievementId) {
            const achievement = achievementsData[achievementId];
            if (!achievement) return;

            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.onclick = () => closeAchievementPopup();

            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-title">üèÜ ÊàêÂ∞±Ëß£ÈéñÔºÅ</div>
                <div class="achievement-description">${achievement.name}</div>
                <div class="achievement-rarity rarity-${achievement.rarity}">${achievement.rarity.toUpperCase()}</div>
                <div class="achievement-description">${achievement.description}</div>
                <div class="achievement-actions">
                    <button class="share-btn" onclick="shareAchievement('${achievementId}')">ÂàÜ‰∫´ÊàêÂ∞± üì§</button>
                    <button class="close-btn" onclick="closeAchievementPopup()">ÈóúÈñâ</button>
                </div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(popup);

            // 3ÁßíÂæåËá™ÂãïÈóúÈñâ
            setTimeout(() => {
                if (document.body.contains(popup)) {
                    closeAchievementPopup();
                }
            }, 5000);
        }

        // ÈóúÈñâÊàêÂ∞±ÂΩàÁ™ó
        function closeAchievementPopup() {
            const overlay = document.querySelector('.overlay');
            const popup = document.querySelector('.achievement-popup');
            if (overlay) overlay.remove();
            if (popup) popup.remove();
        }

        // ÂàÜ‰∫´ÊàêÂ∞±
        function shareAchievement(achievementId) {
            const achievement = achievementsData[achievementId];
            const shareText = `üéÉ ÊàëÂú® Tsext Adventure: Halloween Haunt ‰∏≠Ëß£Èéñ‰∫ÜÊàêÂ∞±„Äå${achievement.name}„ÄçÔºÅ\n\n${achievement.description}\n\n#TsextAdventure #HalloweenHaunt #NSFWGame`;
            const shareUrl = window.location.href;

            showShareModal(shareText, shareUrl, achievement);
        }

        // È°ØÁ§∫ÂàÜ‰∫´Ê®°ÊÖãÊ°Ü
        function showShareModal(text, url, achievement) {
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.onclick = () => closeShareModal();

            const modal = document.createElement('div');
            modal.className = 'achievement-popup';
            modal.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-title">ÂàÜ‰∫´ÊàêÂ∞±</div>
                <div class="achievement-description">ÈÅ∏ÊìáÂàÜ‰∫´Âπ≥Âè∞Ôºö</div>
                <div class="achievement-actions">
                    ${Object.entries(socialPlatforms).map(([platformId, platform]) => `
                        <button class="share-btn" onclick="shareToPlatform('${platformId}', '${encodeURIComponent(text)}', '${encodeURIComponent(url)}')">
                            ${platform.icon} ${platform.name}
                        </button>
                    `).join('')}
                    <button class="close-btn" onclick="closeShareModal()">ÂèñÊ∂à</button>
                </div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(modal);
        }

        // ÈóúÈñâÂàÜ‰∫´Ê®°ÊÖãÊ°Ü
        function closeShareModal() {
            const overlay = document.querySelector('.overlay');
            const modal = document.querySelector('.achievement-popup');
            if (overlay) overlay.remove();
            if (modal) modal.remove();
        }

        // ÂàÜ‰∫´Âà∞Âπ≥Âè∞
        function shareToPlatform(platformId, text, url) {
            const platform = socialPlatforms[platformId];
            let shareUrl = '';

            switch (platformId) {
                case 'twitter':
                    shareUrl = `${platform.url}?text=${text}&url=${url}`;
                    break;
                case 'facebook':
                    shareUrl = `${platform.url}?u=${url}&quote=${text}`;
                    break;
                case 'instagram':
                    // Instagram ÈúÄË¶ÅÊâãÂãïË§áË£Ω
                    navigator.clipboard.writeText(`${text}\n\n${url}`);
                    alert('Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÊùøÔºÅË´ãÂú® Instagram ‰∏≠Ë≤º‰∏ä„ÄÇ');
                    return;
                case 'threads':
                    shareUrl = `${platform.url}?text=${text}`;
                    break;
                case 'line':
                    shareUrl = `${platform.url}?url=${url}&text=${text}`;
                    break;
                case 'reddit':
                    shareUrl = `${platform.url}?url=${url}&title=${text}`;
                    break;
                case 'telegram':
                    shareUrl = `${platform.url}?url=${url}&text=${text}`;
                    break;
                default:
                    // Ë§áË£ΩÂà∞Ââ™Ë≤ºÊùø
                    navigator.clipboard.writeText(`${text}\n\n${url}`);
                    alert('Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÊùøÔºÅ');
                    return;
            }

            window.open(shareUrl, '_blank', 'width=600,height=400');
            closeShareModal();
        }

        // ÂàáÊèõÊàêÂ∞±Èù¢Êùø
        function toggleAchievementsPanel() {
            const panel = document.getElementById('achievementsPanel');
            const toggle = document.getElementById('achievementsToggle');
            
            if (panel.classList.contains('open')) {
                panel.classList.remove('open');
                if (toggle) {
                    toggle.style.right = '0';
                }
            } else {
                panel.classList.add('open');
                if (toggle) {
                    toggle.style.right = '300px';
                }
            }
        }

        // Êõ¥Êñ∞ÊàêÂ∞±Èù¢Êùø
        function updateAchievementsPanel() {
            const panel = document.getElementById('achievementsList');
            if (!panel) return;

            const unlockedCount = gameState.unlockedAchievements.size;
            const totalCount = Object.keys(achievementsData).length;
            
            let html = `
                <div style="text-align: center; margin-bottom: 15px; padding: 10px; background: rgba(139, 92, 246, 0.2); border-radius: 8px;">
                    <div style="font-size: 1.5em; color: #ff6b35; font-weight: bold;">${unlockedCount} / ${totalCount}</div>
                    <div style="font-size: 0.9em; color: #e0e0e0;">Â∑≤Ëß£ÈéñÊàêÂ∞±</div>
                </div>
            `;

            html += Object.entries(achievementsData).map(([achievementId, achievement]) => {
                const isUnlocked = gameState.unlockedAchievements.has(achievementId);
                return `
                    <div class="achievement-item ${isUnlocked ? 'unlocked' : ''}" style="opacity: ${isUnlocked ? '1' : '0.5'}">
                        <div class="achievement-item-icon">${achievement.icon}</div>
                        <div class="achievement-item-text">
                            <div class="achievement-item-name">${achievement.name}</div>
                            <div class="achievement-item-desc">${achievement.description}</div>
                            ${isUnlocked ? '<div style="font-size: 0.7em; color: #ff6b35; margin-top: 3px;">‚úì Â∑≤Ëß£Èéñ</div>' : '<div style="font-size: 0.7em; color: #666; margin-top: 3px;">üîí Êú™Ëß£Èéñ</div>'}
                        </div>
                    </div>
                `;
            }).join('');

            panel.innerHTML = html;
        }

        // Êõ¥Êñ∞Áµ±Ë®àÈù¢Êùø
        function updateStatsPanel() {
            document.getElementById('totalScore').textContent = gameState.totalScore;
            document.getElementById('playCount').textContent = gameState.playCount;
            document.getElementById('achievementCount').textContent = gameState.unlockedAchievements.size;
            document.getElementById('sceneCount').textContent = gameState.visitedScenes.size;
        }

        // ÈñãÂßãÈÅäÊà≤
        function startGame() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('Ë´ãËº∏ÂÖ•‰Ω†ÁöÑÂêçÂ≠óÔºÅ');
                return;
            }

            gameState.playerName = playerName;
            gameState.currentScene = 'start';
            gameState.score = 0;
            gameState.visitedScenes.clear();
            gameState.gameStartTime = Date.now();
            gameState.playCount++;

            // Ê™¢Êü•ÂæΩÁ´†
            const newBadges = checkBadges();
            if (newBadges.length > 0) {
                newBadges.forEach(badgeId => {
                    const badge = badgesData[badgeId];
                    alert(`üèÜ Áç≤ÂæóÂæΩÁ´†Ôºö${badge.name} - ${badge.description}`);
                });
            }

            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('statsPanel').style.display = 'block';
            document.getElementById('achievementsToggle').style.display = 'block';
            
            updateStatsPanel();
            updateAchievementsPanel();
            saveGameData();
            displayScene('start');
        }

        // È°ØÁ§∫Â†¥ÊôØ
        function displayScene(sceneId) {
            const scene = storyData[sceneId];
            if (!scene) {
                alert('Êâæ‰∏çÂà∞Â†¥ÊôØË≥áÊñôÔºÅ');
                return;
            }

            gameState.visitedScenes.add(sceneId);
            gameState.allScenesVisited.add(sceneId);

            let html = `
                <div class="scene-title">üéÉ ${scene.title} üéÉ</div>
                <div class="scene-description">${scene.description.replace(/\n/g, '<br>')}</div>
            `;

            if (scene.is_ending) {
                gameState.score += scene.score || 0;
                gameState.totalScore += scene.score || 0;
                gameState.allEndingsUnlocked.add(sceneId);
                
                // Ê™¢Êü•ÊàêÂ∞±
                checkAchievements(sceneId);

                html += `
                    <div class="ending">
                        <div class="ending-title">üé≠ ÁµêÂ±ÄÔºö${scene.title}</div>
                        <div class="ending-outcome">${scene.outcome.replace(/\n/g, '<br>')}</div>
                        <div class="score">üèÜ ‰Ω†ÁöÑÂàÜÊï∏Ôºö${gameState.score}</div>
                        <div class="score">üìç Êé¢Á¥¢Â†¥ÊôØÊï∏Ôºö${gameState.visitedScenes.size}</div>
                        <div class="score">üéØ Á∏ΩÂàÜÊï∏Ôºö${gameState.totalScore}</div>
                        <button class="restart-btn" onclick="restartGame()">ÈáçÊñ∞ÈñãÂßã üéÉ</button>
                    </div>
                `;
            } else if (scene.choices) {
                html += '<div class="choices">';
                scene.choices.forEach((choice, index) => {
                    html += `
                        <div class="choice" onclick="makeChoice('${choice.next_scene}')">
                            ${choice.option}
                        </div>
                    `;
                });
                html += '</div>';
            }

            document.getElementById('gameArea').innerHTML = html;
        }

        // ÂÅöÂá∫ÈÅ∏Êìá
        function makeChoice(nextScene) {
            displayScene(nextScene);
        }

        // ÈáçÊñ∞ÈñãÂßãÈÅäÊà≤
        function restartGame() {
            gameState.currentScene = 'start';
            gameState.score = 0;
            gameState.visitedScenes.clear();
            gameState.gameStartTime = Date.now();
            gameState.playCount++;

            // Ê™¢Êü•ÂæΩÁ´†
            const newBadges = checkBadges();
            if (newBadges.length > 0) {
                newBadges.forEach(badgeId => {
                    const badge = badgesData[badgeId];
                    alert(`üèÜ Áç≤ÂæóÂæΩÁ´†Ôºö${badge.name} - ${badge.description}`);
                });
            }

            updateStatsPanel();
            saveGameData();
            displayScene('start');
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadGameData();
            updateAchievementsPanel();
            updateStatsPanel();
            console.log('üéÉ Tsext Adventure: Halloween Haunt Â∑≤ËºâÂÖ•ÔºÅ');
        });
    </script>
</body>
</html>
